{"version":3,"sources":["webpack://oneplayer/webpack/universalModuleDefinition","webpack://oneplayer/webpack/bootstrap","webpack://oneplayer/./src/Types.ts","webpack://oneplayer/./src/Errors.ts","webpack://oneplayer/./src/OnePlayer.ts","webpack://oneplayer/external \"dashjs\"","webpack://oneplayer/./src/DefaultPlayer.ts","webpack://oneplayer/./node_modules/base64-js/base64js.min.js","webpack://oneplayer/./src/hlsfp/FairPlayController.ts","webpack://oneplayer/./src/hlsfp/HlsFpPlayer.ts","webpack://oneplayer/./src/dashjs/TTMLController.ts","webpack://oneplayer/./src/tools/DebugComponent.css","webpack://oneplayer/./src/tools/DebugComponent.html","webpack://oneplayer/./src/tools/DebugPanel.ts","webpack://oneplayer/./src/tools/DebugController.ts","webpack://oneplayer/./src/tools/PlaybackSpeedController.ts","webpack://oneplayer/external \"adsplayer.js\"","webpack://oneplayer/./src/plugins/AdsPlugin.ts","webpack://oneplayer/external \"metricsagent.js\"","webpack://oneplayer/./src/plugins/MetricsPlugin.ts","webpack://oneplayer/./src/dashjs/DashJSPlayer.ts","webpack://oneplayer/./index.ts"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__3__","__WEBPACK_EXTERNAL_MODULE__14__","__WEBPACK_EXTERNAL_MODULE__16__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","PlayerType","HasProtocol","ServiceType","PluginType","ChallengeFormatType","MediaType","AudioKind","TextKind","PlayerEvents","PlayerErrorCode","PlayerErrorMessage","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED","CAPABILITY_ERR_MEDIASOURCE","CAPABILITY_ERR_CODEC_UNSUPPORTED","DOWNLOAD_ERR_MANIFEST","DOWNLOAD_ERR_CONTENT","CAPABILITY_ERR_MEDIAKEYS","MEDIA_KEYERR_UNKNOWN","MEDIA_KEYERR_CLIENT","MEDIA_KEYERR_SERVICE","MEDIA_KEYERR_OUTPUT","MEDIA_KEYERR_HARDWARECHANGE","MEDIA_KEYERR_DOMAIN","MEDIAKEYS_ERR_KEYSYSTEM_ACCESS","MEDIAKEYS_ERR_SERVER_CERTIFICATE","MEDIAKEYS_ERR_CREATE_SESSION","MEDIAKEYS_ERR_UNKNOWN_LICENSER","MEDIAKEYS_ERR_LICENSE_REQUEST","MEDIAKEYS_ERR_KEY_ERROR","MEDIAKEYS_ERR_EXPIRED","MEDIAKEYS_ERR_OUTPUT_RESTRICTED","MEDIAKEYS_ERR_INTERNAL_ERROR","PLAYER_INTERNAL_ERROR","Types_1","DashJSPlayer_1","HlsFpPlayer_1","OnePlayer","getVersion","playerType","video","ttmlRenderingDiv","Promise","resolve","reject","player","DASHJS","DashJSPlayer","HLSFP","HlsFpPlayer","init","then","catch","e","addPlugin","type","config","Error","Errors_1","MetricsPlugin_1","AdsPlugin_1","PlaybackSpeedController_1","DebugController_1","DefaultPlayer","this","plugins","videoElement","HTMLMediaElement","stream","storeMediaSettings","mediaSettingsKey","playbackSpeedController","PlaybackSpeedController","debugController","DebugController","logsEnabled","enableLogs","enable","length","enableLastMediaSettingsCaching","applyMediaSettings","removeMediaSettings","reset","stop","load","loadPlugins","_this","pluginLoadPromises","push","all","values","indexOf","loadStream","setPlaybackSpeed","speed","setSpeed","getPlaybackSpeed","getSpeed","stopPlugins","getTracks","tracks","Video","getTracksForType","Audio","Text","plugin","METRICS","MetricsPlugin","ADINSERTION","AdsPlugin","showDebug","show","debugRenderingDiv","showDebugPanel","start","sendErrorEvent","code","extMessage","data","event","document","createEvent","error","message","initCustomEvent","PLAYER_ERROR","dispatchEvent","storeDefaultLanguage","lang","settings","getMediaSettings","localStorage","setItem","JSON","stringify","storeTextState","storedSettings","getItem","parse","undefined","setDefaultAudioLanguage","setDefaultTextLanguage","setDefaultTextEnabled","console","log","removeItem","f","u","a","v","/","byteLength","toByteArray","h","charCodeAt","fromByteArray","join","Uint8Array","Array","base64","FairPlayController","protectionData","keySystemConfiguration","mediaKeySession","licenseRequest","needKeyListener","onNeedKey","keyMessageListener","onKeyMessage","keyAddedListener","onKeyAdded","keyErrorListener","onKeyError","addEventListener","abort","removeEventListener","debug","stringToArray","str","buffer","ArrayBuffer","array","Uint16Array","getChallengeFormatType","challengeFormat","OCTET_STREAM","extractContentId","initData","parts","String","fromCharCode","apply","split","getCertificate","serverCertificate","concatInitDataIdAndCertificate","id","cert","idArray","offset","dataView","DataView","initDataArray","set","setUint32","id16Array","processLicenseMessage","encodeURIComponent","contentId","sendLicenseRequest","url","challenge","challengeFormatType","XMLHttpRequest","success","responseType","onload","status","readyState","onloadend","open","setRequestHeader","send","processLicenseResponse","request","TEXT","responseText","trim","substr","slice","response","update","getKeyError","target","systemCode","certificate","mediaKeys","createSession","serverUrl","serverURL","DefaultPlayer_1","FairPlayController_1","_super","__extends","getPlayerType","defaultAudioLanguage","defaultTextLanguage","defaultTextEnabled","selectedTextTrackId","loadedmetadataListener","onLoadedmetadata","canplayListener","onCanPlay","seekedListener","onSeeked","errorListener","onError","setConfig","params","fpcontroller","listener","scope","play","pause","seek","time","currentTime","isLive","removeAttribute","getDuration","duration","Number","POSITIVE_INFINITY","getTime","getVideoTracks","getAudioTracks","getTextTracks","getSelectedTrackForType","getSelectedAudioTrack","getSelectedTextTrack","getQualityForType","getBufferLevelForType","selectTrackForType","selectAudioTrack","selectTextTrack","selectTrack","track","mediaType","enableText","textTracks","isTextEnabled","protData","src","limitToLowestBitrate","state","tracksInfo","trackInfo","selected","codec","mimeType","qualities","audioTracks","audioTrackToMediaInfo","textTrackToMediaInfo","selectedLang","language","enabled","label","audioTrack","kind","textTrack","dashjs","TTMLController","mediaPlayer","on","MediaPlayer","events","TTML_TO_PARSE","onTTMLPreProcess","ttmlSubtitles","replace","OnePlayer_1","html","css","Chartist","DebugPanel","version","protocol","streamType","playbackState","playbackTime","jitter","videoBuffer","audioBuffer","bufferTarget","videoBitrate","connectionSpeed","playbackQuality","containerDiv","debugDiv","pollInterval","videoBufferSizes","audioBufferSizes","videoQualities","connectionSpeeds","stateChangedListener","onStateChanged","pauseListener","onPause","qualityRenderedListener","onQualityRendered","registerEvents","unregisterEvents","LIVE","render","stopMetricsPolling","parentElement","createDebugPanel","removeChild","liveStartTime","liveStartPlaybackTime","startMetricsPolling","Date","newQuality","updateMetrics","setInterval","clearInterval","updateDashMetrics","videoMetrics","getMetricsFor","BufferState","Math","max","updateBufferLevel","videoBufferChart","updateConnectionSpeed","audioMetrics","audioBufferChart","updateVideoBitrate","metrics","bufferSizes","chart","level","BufferLevel","appendChartValue","options","high","videoTrack","videoBitrateChart","qualityIndex","quality","bitrate","HttpList","responsecode","responseTime","tresponse","downloadTimeInSeconds","_tfinish","downloadBytes","trace","reduce","b","round","connectionSpeedChart","shift","querySelector","innerHTML","toFixed","formatDuration","getPlaybackQualityInfos","formatBitrate","series","style","visibility","floor","bitrateInKbps","qualityInfos","width","height","loadChartist","node","createElement","ShowDebug","getElementsByTagName","appendChild","addStyles","optionsBufferChart","low","fullWidth","showPoint","showLine","showArea","chartPadding","bottom","left","right","top","axisX","showGrid","showLabel","axisY","lineSmooth","Interpolation","none","Line","step","simple","head","getHeadSection","elements","body","DebugPanel_1","verbose","onKeyPressedListener","onKeyPressed","debugPanel","altKey","ctrlKey","shiftKey","keyCode","playerVersion","trickModeSpeed","volume","playPromise","onSeekedListener","stopTrickMode","isNaN","applySpeed","playbackRate","abs","startTrickMode","paused","onPlay","clearTimeout","seekTimeout","seekTime","seekPos","min","elapsedTime","setTimeout","adsplayer_js_1","getType","checkInitialized","adsPlayer","handleMainPlayerPlayback","adsRenderingDiv","AdsPlayer","EventTypes","ERROR","START","onStart","END","onEnd","ADD_ELEMENT","onAddElement","REMOVE_ELEMENT","onRemoveElement","PLAY","PAUSE","CLICK","onClick","destroy","res","display","sendEvent","AD_ERROR","AD_START","AD_END","eventType","MetricsAgent","DEFAULT_SETTINGS","activationUrl","dbServerUrl","collector","formatter","sendingTime","metricsAgent","TTMLController_1","MSS","liveDelay","stableBufferTime","bufferTimeAtTopQuality","bufferTimeAtTopQualityLongForm","lowLatencyEnabled","keepProtectionMediaKeys","MEDIAINFO_TYPE_TO_MEDIATYPE","audio","text","fragmentedText","embeddedText","defaultSettings","audioSettings","PLAYBACK_PLAYING","onPlaybackPlaying","PLAYBACK_SEEKING","onPlaybackSeeking","PLAYBACK_WAITING","onPlaybackWaiting","ttmlController","getDefaultSettings","initialize","attachTTMLRenderingDiv","parentNode","enableLastBitrateCaching","setLowLatencyEnabled","applySettings","getDebug","setLogToBrowserConsole","off","isDynamic","attachSource","isReady","selectedTrack","getCurrentTrackFor","getTracksFor","mediaInfoToTrackInfo","trackInfos","getQualityFor","getBufferLength","filter","mediaInfo","idx","parseInt","setCurrentTrack","setTextDefaultLanguage","setTextDefaultEnabled","setProtectionData","downloadError","STREAM_INITIALIZED","onStreamInitialized","setInitialMediaSettingsFor","videoInfo","audioInfo","setMaxAllowedBitrateFor","NaN","getLiveDelay","getStableBufferTime","getBufferTimeAtTopQuality","getBufferTimeAtTopQualityLongForm","getLowLatencyEnabled","setLiveDelay","setStableBufferTime","setBufferTimeAtTopQuality","setBufferTimeAtTopQualityLongForm","minVideoBitrate","setMinAllowedBitrateFor","index","toString","bitrateList","map","item","bandwidth","roles","Main","Translation","accessibility","Clean","Alternative","Commentary","Descriptions","Captions","Subtitles","startTime","getResponseText","dashType","processDownloadError","segmentTime","segmentDuration","errors","CAPABILITY_MEDIASOURCE_ERROR_CODE","MEDIASOURCE_TYPE_UNSUPPORTED_CODE","DOWNLOAD_ERROR_ID_MANIFEST_CODE","DOWNLOAD_ERROR_ID_INITIALIZATION_CODE","DOWNLOAD_ERROR_ID_CONTENT_CODE","CAPABILITY_MEDIAKEYS_ERROR_CODE","MEDIA_KEYERR_UNKNOWN_CODE","MEDIA_KEYERR_CLIENT_CODE","MEDIA_KEYERR_SERVICE_CODE","MEDIA_KEYERR_OUTPUT_CODE","MEDIA_KEYERR_DOMAIN_CODE","KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE","messageS","SERVER_CERTIFICATE_UPDATED_ERROR_CODE","KEY_SESSION_CREATED_ERROR_CODE","MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE","MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE","MEDIA_KEYERR_CODE","KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE"],"mappings":"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","file":"oneplayer.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"dashjs\"), require(\"adsplayer.js\"), require(\"metricsagent.js\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"oneplayer\", [\"dashjs\", \"adsplayer.js\", \"metricsagent.js\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"oneplayer\"] = factory(require(\"dashjs\"), require(\"adsplayer.js\"), require(\"metricsagent.js\"));\n\telse\n\t\troot[\"oneplayer\"] = factory(root[\"dashjs\"], root[\"adsplayer.js\"], root[\"metricsagent.js\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__3__, __WEBPACK_EXTERNAL_MODULE__14__, __WEBPACK_EXTERNAL_MODULE__16__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 19);\n","export enum PlayerType {\n    /** dash.js */\n    DASHJS = 'DASHJS',\n\n    /** Native HLS + FairPlay (Safari only) */\n    HLSFP = 'HLSFP'\n}  \n\nexport enum HasProtocol {\n    /** MPEG-DASH */\n    DASH = 'DASH',\n\n    /** Microsoft Smooth Streaming */\n    MSS = 'MSS',\n\n    /** Apple Http Live Streaming */\n    HLS = 'HLS'\n}  \n\nexport enum ServiceType {\n    /** Live service */\n    LIVE = 'LIVE',\n\n    /** On-demand such as VOD or catchup */\n    ONDEMAND = 'ONDEMAND'\n}  \n\nexport enum PluginType {\n    /** Metrics collector, using project metricsagent.js */\n    METRICS = 'METRICS',\n\n    /** Ad-insertion, using project adsplayer.js */\n    ADINSERTION = 'ADINSERTION'\n}  \n\nexport enum ChallengeFormatType {\n    OCTET_STREAM = 'octet-stream',\n    TEXT = 'text'\n}\n\nexport interface KeySystemConfiguration {\n    /** The licenser server URL */\n    serverURL?: string,\n\n    /** Wether license request is made using credentials */\n    withCredentials?: Boolean,\n\n    /** The HTTP request headers to be set in the license request as an object containing list of key/values pairs */\n    httpRequestHeaders?: object,\n\n    /** The licenser server certificate as a BASE64 string representation of the binary stream */\n    serverCertificate?: string,\n\n    /** The audio robustness level */\n    audioRobustness?: string,\n\n    /** The video robustness level */\n    videoRobustness?: string,\n\n    /** The session type (see https://w3c.github.io/encrypted-media/#dom-mediakeysessiontype) */\n    sessionType?: string,\n\n    /** The session id (see https://w3c.github.io/encrypted-media/#session-id) */\n    sessionId?: string,\n\n    /** The license request challenge format, 'octet-stream' or 'text' */\n    challengeFormat?: ChallengeFormatType\n}\n\nexport interface ProtectionData {\n    /** List of property names corresponding to key system name strings and associated values being instances of KeySystemConfiguration */\n    [keySystemId: string]: KeySystemConfiguration\n}\n\nexport interface StreamInfo {\n    /** The manifest URL */\n    url: string,\n\n    /** The HTTP streaming protocol */\n    protocol?: HasProtocol,\n\n    /** The service type */\n    type?: ServiceType,\n\n    /** The protection data */ \n    protData?: ProtectionData,\n\n    /** The start time (in seconds) at which playback should start */\n    startTime?: number,\n\n    /** The metrics collector server URL */\n    metricsUrl?: string,\n\n    /** The ad-insertion description (MAST) file URL */\n    adsUrl?: string,\n\n    /** Some user/service specific data as an object containing list of key/values pairs */\n    userData?: object\n}\n\nexport enum MediaType {\n    /** Video */\n    Video = 'video',\n\n    /** Audio */\n    Audio = 'audio',\n\n    /** Text */\n    Text = 'text'\n}\n\nexport enum AudioKind {\n    /** A possible alternative to the main track, e.g., a different take of a song (audio) */\n    Alternative = 'alternative',\n\n    /** An audio description of a video track */\n    Descriptions = 'descriptions',\n\n    /** The primary audio track */\n    Main = 'main',\n\n    /** The primary audio track, mixed with audio descriptions */\n    MainDesc = 'main-desc',\n\n    /** A translated version of the main audio track */\n    Translation = 'translation',\n\n    /** The primary audio track, mixed with audio descriptions */\n    Commentary = 'commentary',\n\n    /** Audio cleaned of ambient noise, for the hearing impaired */\n    Clean = 'clean',\n\n}\n\nexport enum TextKind {\n    /** Transcription or translation of audio, suitable for when sound is unavailable or not clearly audible\n        (e.g., because it is muted, drowned-out by ambient noise, or because the user is deaf) */\n    Captions = 'captions',\n\n    /** Transcription or translation of the dialog, suitable for when the sound is available but not understood\n       (e.g., because the user does not understand the language of the media resources audio track) */\n    Subtitles = 'subtitles',\n\n    /** Textual descriptions of the video content, when the visual content is obscured, unavailable, or not usable */\n    Descriptions = 'descriptions',\n\n    /** The track defines chapter titles (suitable for navigating the media resource) */\n    Chapters = 'chapters',\n\n    /** The track defines content used by scripts. Not visible for the user */\n    Metadata = 'metadata',\n}\n\nexport interface Quality {\n    /** The encoding bitrate (in bits/sec) */\n    bitrate: number,\n\n    /** The video width (in case of video tracks) */\n    width?: number,\n\n    /** The video height (in case of video tracks) */\n    height?: number\n}\n\nexport interface TrackInfo {\n    /** The track media type */\n    mediaType: MediaType,\n  \n    /** The track ID */\n    id: string,\n\n    /** The track selected state */\n    selected: boolean,\n\n    /** The track kind or category (for audio or text tracks) */\n    kind?: AudioKind | TextKind,\n\n    /** The track language based on ISO 639-2 */\n    lang?: string,\n  \n    /** The mime-type of the track content format  */\n    mimeType?: string,\n\n    /** The codec used to encode the track content */\n    codec?: string,\n    \n    /** The list of availables qualities for the track */\n    qualities?: Quality[]\n}\n\nexport enum PlayerEvents {\n    /**\n     * The PLAYER_ERROR event is fired when an error occurs.\n     * When the PLAYER_ERROR event is fired, the application shall stop the player using the {@link IPlayer.stop} method.\n     * <br/>Event properties:\n     * @event PLAYER_ERROR\n     * @property <b>name</b>: string - the event name (PLAYER_ERROR)\n     * @property <b>detail</b>: {@link PlayerError} - the error\n     */\n    PLAYER_ERROR = 'player_error',\n\n    /**\n     * The AD_ERROR event is fired when an error is raised by the AdsPlugin.\n     * <br/>Event properties:\n     * @event AD_ERROR\n     * @property <b>name</b>: string - the event name (AD_ERROR)\n     * @property <b>detail</b>: {@link PlayerError} - the error\n     */\n    AD_ERROR = 'ad_error',\n\n    /**\n     * The AD_START event is fired when some ads will start to play.\n     * When the AD_START event is fired, the application shall record the current video time and stop the player using the {@link IPlayer.stop} method.\n     * This event may be fired when the ADINSERTION plugin is loaded.\n     * <br/>Event properties:\n     * @event AD_START\n     * @property <b>name</b>: string - the event name (AD_START)\n     */\n    AD_START = 'ad_start',\n\n    /**\n     * The AD_END event is fired when some ads ended to play.\n     * When the AD_END event is fired, the application shall restart the player, at the recorded playback time, using the {@link IPlayer.load} method.\n     * This event may be fired when the ADINSERTION plugin is loaded.\n     * <br/>Event properties:\n     * @event AD_START\n     * @property <b>name</b>: string - the event name (AD_END)\n     */\n    AD_END = 'ad_end'\n}\n","export enum PlayerErrorCode {\n\n    // #region HTMLMediaElement errors\n    // --------------------------------------------------\n\n    MEDIA_ERR_ABORTED = 1,\n    MEDIA_ERR_NETWORK = 2,\n\n    /**\n     * The HTMLVideoElement failed to decode the audio or video stream\n     */\n    MEDIA_ERR_DECODE = 3,\n\n    /**\n     * Audio or video media type is not supported by the HTMLVideoElement\n     */\n    MEDIA_ERR_SRC_NOT_SUPPORTED = 4,\n\n    /**\n     * The stream could not be played because it is encrypted and one of the following:</br>\n     * <ul>\n     * <li>No key was provided and no needkey handler was provided</li>\n     * <li>The provided key could not be successfully applied</li>\n     * <li>The user agent does not support decryption of this media data</li>\n     * </ul>\n     */\n    MEDIA_ERR_ENCRYPTED = 5,\n\n    // #endregion HTMLMediaElement errors\n    // --------------------------------------------------\n\n    // #region MSE capability errors\n    // --------------------------------------------------\n\n    /**\n     * The user agent does not support Media Source Extensions.\n     */\n    CAPABILITY_ERR_MEDIASOURCE = 10,\n\n    /**\n     * The mime-type or codec is not supported.\n     */\n    CAPABILITY_ERR_CODEC_UNSUPPORTED = 11,\n\n    // #endregion MSE capability errors\n    // --------------------------------------------------\n\n    // #region Download errors\n    // --------------------------------------------------\n\n    /**\n     * The player failed to download the manifest.\n     * Error data properties:\n     * @property <b>url</b>: string - the manifest url\n     * @property <b>status</b>: number - the response status code\n     * @property <b>response</b>: string - the response text\n     */\n    DOWNLOAD_ERR_MANIFEST = 20,\n\n    /**\n     * The player failed to download some media segments, leading to freeze playback of the content.\n     * Error data properties:\n     * @property <b>url</b>: string - the manifest url\n     * @property <b>status</b>: number - the response status code\n     * @property <b>response</b>: string - the response text\n     */\n    DOWNLOAD_ERR_CONTENT = 21,\n\n    // #endregion Download errors\n    // --------------------------------------------------\n\n    // #region EME errors\n    // --------------------------------------------------\n\n    /**\n     * The user agent does not support Encrypted Media Extensions or they are disabled (unsecure origin).\n     */\n    CAPABILITY_ERR_MEDIAKEYS = 100,\n\n    /**\n     * An unspecified error occurred. This value is used for errors that don't match any of the following codes.\n     * </br><i>Note: This error may be raised in user agents embedding Encrypted Media Extensions v0.1 (July 2012)</i>\n     */\n    MEDIA_KEYERR_UNKNOWN = 101,\n\n    /**\n     * The Key System could not be installed or updated.\n     * </br><i>Note: This error may be raised in user agents embedding Encrypted Media Extensions v0.1 (July 2012)</i>\n     */\n    MEDIA_KEYERR_CLIENT = 102,\n\n    /**\n     * The message passed into addKey indicated an error from the license service.\n     * </br><i>Note: This error may be raised in user agents embedding Encrypted Media Extensions v0.1 (July 2012)</i>\n     */\n    MEDIA_KEYERR_SERVICE = 103,\n\n    /**\n     * There is no available output device with the required characteristics for the content protection system.\n     * </br><i>Note: This error may be raised in user agents embedding Encrypted Media Extensions v0.1 (July 2012)</i>\n     */\n    MEDIA_KEYERR_OUTPUT = 104,\n\n    /**\n     * A hardware configuration change caused a content protection error.\n     * </br><i>Note: This error may be raised in user agents embedding Encrypted Media Extensions v0.1 (July 2012)</i>\n     */\n    MEDIA_KEYERR_HARDWARECHANGE = 105,\n\n    /**\n     * An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.\n     * </br><i>Note: This error may be raised in user agents embedding Encrypted Media Extensions v0.1 (July 2012)</i>\n     */\n    MEDIA_KEYERR_DOMAIN = 106,\n\n    /**\n     * Key system access has been denied. No Key System compatible with Key Systems used to encrypt the content is available\n     * in the user agent, or the Key System does not support requested capabilities.\n     */\n    MEDIAKEYS_ERR_KEYSYSTEM_ACCESS = 110,\n\n    /**\n     * An error occurred when providing to the CDM the server certificate to be used to encrypt messages to the license server.\n     */\n    MEDIAKEYS_ERR_SERVER_CERTIFICATE = 111,\n\n    /**\n     * an error occured either while creating a session and generate a license request, either while loading a persistent session.\n     */\n    MEDIAKEYS_ERR_CREATE_SESSION = 112,\n\n    /**\n     * The licenser server URL has not been provided.\n     */\n    MEDIAKEYS_ERR_UNKNOWN_LICENSER = 113,\n\n    /**\n     * The license request to the licenser server failed.\n     * Error data properties:\n     * @property <b>url</b>: string - the license server url\n     * @property <b>status</b>: number - the response status code\n     * @property <b>response</b>: string - the response text\n     */\n    MEDIAKEYS_ERR_LICENSE_REQUEST = 114,\n\n    /**\n     * An error occurred while providing messages, including licenses, to the CDM.\n     */\n    MEDIAKEYS_ERR_KEY_ERROR = 115,\n\n    /**\n     * The license has expired.\n     */\n    MEDIAKEYS_ERR_EXPIRED = 116,\n    \n    /**\n     * There are output restrictions associated with the key that cannot currently be met.\n     * Media data decrypted with this key may be blocked from presentation, if necessary according to the output restrictions.\n     */\n    MEDIAKEYS_ERR_OUTPUT_RESTRICTED = 117,\n\n    /**\n     * The key is not currently usable for decryption because of an error in the CDM.\n     */\n    MEDIAKEYS_ERR_INTERNAL_ERROR = 118,\n\n    // #endregion EME errors\n    // --------------------------------------------------\n\n    // #region Other errors\n    // --------------------------------------------------\n\n    /**\n     * Content morality level is too high to be played. It is necessary to unlock the stream with the appropriate adult code.\n     */\n    MEDIA_MORALITY_ERR = 130,\n\n    /**\n     * An error occurred when executing a player API function.\n     */\n    PLAYER_API_ERROR = 998,\n\n    /**\n     * An internal error in the player.\n     * The data property contains the error as returned by the player\n     */\n    PLAYER_INTERNAL_ERROR = 999\n\n    // #endregion Other errors\n    // --------------------------------------------------\n}\n\nexport interface PlayerError {\n    /** The error code */\n    code: PlayerErrorCode,\n\n    /** The error message */\n    message: string,\n\n    /** Extended message */\n    extMessage?: string,\n\n    /** The error data. Refer to each code to get the data object properties description */\n    data?: object\n}\n\nexport const PlayerErrorMessage = {}\nPlayerErrorMessage[PlayerErrorCode.MEDIA_ERR_ABORTED] = 'Fetching process aborted';\nPlayerErrorMessage[PlayerErrorCode.MEDIA_ERR_NETWORK] = 'Network error';\nPlayerErrorMessage[PlayerErrorCode.MEDIA_ERR_DECODE] = 'Media decoding error';\nPlayerErrorMessage[PlayerErrorCode.MEDIA_ERR_SRC_NOT_SUPPORTED] = 'Media format not supported';\nPlayerErrorMessage[PlayerErrorCode.MEDIA_ERR_ENCRYPTED] = 'Media is encrypted';\n\nPlayerErrorMessage[PlayerErrorCode.CAPABILITY_ERR_MEDIASOURCE] = 'Media Source extensions are not supported';\nPlayerErrorMessage[PlayerErrorCode.CAPABILITY_ERR_CODEC_UNSUPPORTED] = 'Media codec is not supported';\n\nPlayerErrorMessage[PlayerErrorCode.DOWNLOAD_ERR_MANIFEST] = 'Failed to download manifest';\nPlayerErrorMessage[PlayerErrorCode.DOWNLOAD_ERR_CONTENT] = 'Failed to download media segment';\n\nPlayerErrorMessage[PlayerErrorCode.CAPABILITY_ERR_MEDIAKEYS] = 'DRM: Encrypted Media extensions are not supported or enabled';\nPlayerErrorMessage[PlayerErrorCode.MEDIA_KEYERR_UNKNOWN] = 'DRM: An unspecified error occurred';\nPlayerErrorMessage[PlayerErrorCode.MEDIA_KEYERR_CLIENT] = 'DRM: Failed to install or update Key System';\nPlayerErrorMessage[PlayerErrorCode.MEDIA_KEYERR_SERVICE] = 'DRM: License service error';\nPlayerErrorMessage[PlayerErrorCode.MEDIA_KEYERR_OUTPUT] = 'DRM: Output is restricted';\nPlayerErrorMessage[PlayerErrorCode.MEDIA_KEYERR_HARDWARECHANGE] = 'DRM: Error due to a hardware configuration change';\nPlayerErrorMessage[PlayerErrorCode.MEDIA_KEYERR_DOMAIN] = 'DRM: Failed to join the domain';\nPlayerErrorMessage[PlayerErrorCode.MEDIAKEYS_ERR_KEYSYSTEM_ACCESS] = 'DRM: Key System configuration is not supported';\nPlayerErrorMessage[PlayerErrorCode.MEDIAKEYS_ERR_SERVER_CERTIFICATE] = 'DRM: Failed to update server certificate';\nPlayerErrorMessage[PlayerErrorCode.MEDIAKEYS_ERR_CREATE_SESSION] = 'DRM: Failed to create session';\nPlayerErrorMessage[PlayerErrorCode.MEDIAKEYS_ERR_UNKNOWN_LICENSER] = 'DRM: Missing license server url';\nPlayerErrorMessage[PlayerErrorCode.MEDIAKEYS_ERR_LICENSE_REQUEST] = 'DRM: Failed to request license';\nPlayerErrorMessage[PlayerErrorCode.MEDIAKEYS_ERR_KEY_ERROR] = 'DRM: License error';\nPlayerErrorMessage[PlayerErrorCode.MEDIAKEYS_ERR_EXPIRED] = 'DRM: The license has expired';\nPlayerErrorMessage[PlayerErrorCode.MEDIAKEYS_ERR_OUTPUT_RESTRICTED] = 'DRM: Output is restricted';\nPlayerErrorMessage[PlayerErrorCode.MEDIAKEYS_ERR_INTERNAL_ERROR] = 'DRM: Session error';\n\nPlayerErrorMessage[PlayerErrorCode.PLAYER_INTERNAL_ERROR] = 'Internal error';\n\n","import { IPlayer } from './IPlayer'\nimport { PlayerType, PluginType } from './Types'\nimport { DefaultPlayer } from './DefaultPlayer';\n// #if process.env.DASHJS === \"true\"\nimport { DashJSPlayer } from './dashjs/DashJSPlayer';\n// #endif\n// #if process.env.HLSFP === \"true\"\nimport { HlsFpPlayer } from './hlsfp/HlsFpPlayer';\n// #endif\n\ndeclare const __VERSION__: string;\nconst VERSION = __VERSION__\n\nconst UNKNOWN_PLAYERTYPE_ERROR = 'Unknown player type';\n\n/**\n * OnePlayer is the main class that has to be used to create player instances.\n */\nexport class OnePlayer {\n\n    /**\n     * Returns current version of oneplayer.js.\n     * @return current version of oneplayer.js\n     */\n    static getVersion (): string {\n        return VERSION;\n    }\n\n    /**\n     * Creates a new instance of a player.\n     * This methods creates a player instance of the given type.\n     * @param {HTMLElement} video - the HTML5 video element used to decode and render the media data\n     * @param {HTMLDivElement} ttmlRenderingDiv - the HTML5 div to render rich TTML subtitles\n     * @returns {Promise} a promise which is resolved with the created player, or rejected if failed to create the player\n     */\n    static create (playerType: PlayerType, video: HTMLElement, ttmlRenderingDiv?: HTMLDivElement): Promise<IPlayer> {\n        return new Promise<IPlayer>((resolve, reject) => {\n            let player = null;\n            switch (playerType) {\n                // #if process.env.DASHJS === \"true\"\n                case PlayerType.DASHJS:\n                    player = new DashJSPlayer();\n                    break;\n                // #endif\n                // #if process.env.HLSFP === \"true\"\n                case PlayerType.HLSFP:\n                    player = new HlsFpPlayer();\n                    break;\n                // #endif\n                default:\n                throw UNKNOWN_PLAYERTYPE_ERROR;\n            }\n    \n            player.init(video, ttmlRenderingDiv).then(() => {\n                resolve(player);\n            })\n            .catch((e) => {\n                reject(e);\n            });\n        });\n    }\n\n    /**\n     * Adds a plugin.\n     * @param {IPlayer} player - IPlayer reference\n     * @param {PluginType} type - the type of the plugin\n     * @param {object} config - the plugin configuration parameters\n     */\n    static addPlugin (player: IPlayer, type: PluginType, config?: object) {\n        if (!player) {\n            throw new Error('The player instance is not valid while adding the plugin'); \n        }\n        (player as DefaultPlayer).addPlugin(type, config);\n    }\n}\n  ","module.exports = __WEBPACK_EXTERNAL_MODULE__3__;","import { PlayerType, StreamInfo, MediaType, TrackInfo, PluginType, PlayerEvents } from './Types'\nimport { IPlayer } from './IPlayer'\nimport { PlayerErrorCode, PlayerErrorMessage } from './Errors'\nimport { IPlugin } from './plugins/IPlugin'\n// #if process.env.METRICS === \"true\"\nimport { MetricsPlugin } from './plugins/MetricsPlugin'\n// #endif\n// #if process.env.ADINSERTION === \"true\"\nimport { AdsPlugin } from './plugins/AdsPlugin'\n// #endif\nimport { PlaybackSpeedController } from './tools/PlaybackSpeedController'\nimport { DebugController } from './tools/DebugController'\n\n\nconst DEFAULT_MEDIA_SETTINGS_KEY = 'oneplayerjs_media_settings';\n\n/**\n * Default player implementation\n */\nexport abstract class DefaultPlayer implements IPlayer {\n    // #region MEMBERS\n    // --------------------------------------------------\n\n    // <video> / HTMLMediaElement\n    protected videoElement: HTMLMediaElement;\n\n    // The input stream\n    protected stream: StreamInfo;\n\n    // Track settings caching state\n    protected storeMediaSettings: boolean;\n\n    // Track settings key\n    protected mediaSettingsKey: string;\n\n    // Playback speed controller\n    protected playbackSpeedController: PlaybackSpeedController;\n\n    // Debug controller\n    protected debugController: DebugController;\n\n    // Plugins\n    protected plugins: IPlugin[] = [];\n\n    // Logs state\n    protected logsEnabled: boolean;\n\n    // #endregion MEMBERS\n    // --------------------------------------------------\n\n    // #region CONSTRUCTOR\n    // --------------------------------------------------\n\n    /**\n     * Constructor.\n     */\n    constructor () {\n    }\n    // #endregion CONSTRUCTOR\n\n    // #region PUBLIC FUNCTIONS\n    // --------------------------------------------------\n\n    // #region SETUP\n    // --------------------------------------------------\n\n    public abstract getVersion (): string;\n\n    public abstract getPlayerType (): PlayerType;\n\n    public init (videoElement: HTMLElement, ttmlRenderingDiv?: HTMLDivElement): Promise<any> {\n        if (!(videoElement instanceof HTMLMediaElement)) {\n            throw new Error('video element must be instance of HTMLMediaElement');\n        }\n        this.videoElement = videoElement as HTMLMediaElement;\n        this.stream = null;\n        this.storeMediaSettings = false;\n        this.mediaSettingsKey = DEFAULT_MEDIA_SETTINGS_KEY;\n        this.playbackSpeedController = new PlaybackSpeedController();\n        this.playbackSpeedController.init(this.videoElement);\n        this.debugController = new DebugController(this, this.videoElement);\n        this.logsEnabled = false;\n\n        return Promise.resolve();\n    }\n\n    abstract setConfig (params: object);\n\n    public enableLogs (enable: boolean) {\n        this.logsEnabled = enable;\n        for (let i = 0; i < this.plugins.length; i++) {\n            this.plugins[i].enableLogs(enable);\n        }\n    }\n\n    public enableLastMediaSettingsCaching (enable: boolean, key = DEFAULT_MEDIA_SETTINGS_KEY) {\n        this.storeMediaSettings = enable;\n        if (key && key.length > 0) {\n            this.mediaSettingsKey = key;\n        }\n        if (this.storeMediaSettings) {\n            this.applyMediaSettings();\n        } else {\n            this.removeMediaSettings();\n        }\n    }\n\n    abstract addEventListener (type: string, listener: any, scope?: object);\n\n    abstract removeEventListener (type: string, listener: any, scope?: object);\n\n    public reset () {\n        this.stop();\n        this.debugController.reset();\n        // Reset plugins\n        for (let i = 0; i < this.plugins.length; i++) {\n            this.plugins[i].reset();\n        }                \n    }\n\n    // #endregion SETUP\n    // --------------------------------------------------\n\n    // #region PLAYBACK CONTROL\n    // --------------------------------------------------\n\n    public load (stream: StreamInfo, loadPlugins = true) {\n        // Stop previous stream\n        if (this.stream) {\n            this.stop();\n        }\n\n        // Apply media settings from local storage\n        this.applyMediaSettings();\n\n        if (!loadPlugins) {\n            this.loadStream(stream);\n            return;\n        }\n\n        let pluginLoadPromises: Promise<any>[] = [];\n        for (let i = 0; i < this.plugins.length; i++) {\n            pluginLoadPromises.push(this.plugins[i].load(stream));\n        }\n\n        Promise.all(pluginLoadPromises).then((values) => {\n            // In case AdsPlugin encounter a pre-roll ad, then do not start stream playback\n            if (values.indexOf('preroll') === -1) {\n                this.loadStream(stream);\n            }\n        }).catch((e) => {\n            this.loadStream(stream);\n        });\n    }\n\n    abstract play ();\n    abstract pause ();\n    abstract seek (time: number);\n\n    public setPlaybackSpeed (speed: number) {\n        this.playbackSpeedController.setSpeed(speed);\n    }\n\n    public getPlaybackSpeed () : number {\n        return this.playbackSpeedController.getSpeed();\n    }\n\n    public stop (reset = true, stopPlugins = true) {\n\n        if (reset) {\n            this.stream = null;\n            this.playbackSpeedController.reset();\n            this.debugController.stop();\n        } else {\n            this.playbackSpeedController.setSpeed(1);\n        }\n\n        if (stopPlugins) {\n            // Call stop on plugins\n            for (let i = 0; i < this.plugins.length; i++) {\n                this.plugins[i].stop();\n            }        \n        }\n    }\n\n    // #endregion PLAYBACK CONTROL\n    // --------------------------------------------------\n    \n    // #region DURATION / TIME\n    // --------------------------------------------------\n\n    abstract getDuration () : number;\n    abstract isLive ();\n    abstract getTime () : number;\n\n    // #endregion DURATION / TIME\n    // --------------------------------------------------\n\n    // #region AUDIO/SUBTITLES TRACKS\n    // --------------------------------------------------\n\n    /**\n     * Returns the list of tracks for a given media type\n     * @returns {object} the list of {@link TrackInfo} for each media type\n     */\n    public getTracks (type: MediaType): object {\n        let tracks = {};\n        tracks[MediaType.Video] = this.getTracksForType(MediaType.Video);\n        tracks[MediaType.Audio] = this.getTracksForType(MediaType.Audio);\n        tracks[MediaType.Text] = this.getTracksForType(MediaType.Text);\n        return tracks;\n    }\n\n    abstract getTracksForType (type: MediaType): TrackInfo[];\n    abstract getSelectedTrackForType (type: MediaType): TrackInfo;\n    abstract getQualityForType (type: MediaType): number;\n    abstract getBufferLevelForType (type: MediaType): number;\n    abstract selectTrackForType (type: MediaType, id: string);\n    abstract selectTrack (track: TrackInfo);\n    abstract setDefaultAudioLanguage (lang: string);\n    abstract setDefaultTextLanguage (lang: string);\n    abstract enableText (enable: boolean);\n    abstract isTextEnabled () : boolean;\n    abstract setDefaultTextEnabled (enable: boolean);\n\n    // #endregion AUDIO/SUBTITLES TRACKS\n    // --------------------------------------------------    \n\n    // #region PLUGIN\n    // --------------------------------------------------\n\n    public addPlugin (type: PluginType, config?: object) {\n        let plugin;\n        switch (type) {\n            // #if process.env.METRICS === \"true\"\n            case PluginType.METRICS:\n                plugin = new MetricsPlugin();\n                break;\n            // #endif\n            // #if process.env.ADINSERTION === \"true\"\n            case PluginType.ADINSERTION:\n                plugin = new AdsPlugin();\n                break;\n            // #endif\n            default:\n                throw new Error('Unknown plugin type: ' + type)\n        }\n        plugin.init(this, this.videoElement, config);\n        plugin.enableLogs(this.logsEnabled);\n        this.plugins.push(plugin);\n    }\n\n    // #endregion PLUGIN\n    // --------------------------------------------------\n\n    // #region DEBUG\n    // --------------------------------------------------\n\n    public showDebug (show: boolean, debugRenderingDiv?: HTMLDivElement) {\n        this.debugController.showDebugPanel(show, debugRenderingDiv);\n    }\n\n    // #endregion DEBUG\n    // --------------------------------------------------\n\n    // #endregion PUBLIC FUNCTIONS\n    // --------------------------------------------------\n\n    // #region PROTECTED FUNCTIONS\n    // --------------------------------------------------\n\n    protected loadStream(stream: StreamInfo) {\n        this.stream = stream;\n        this.debugController.start(stream);\n    }\n\n    protected abstract limitToLowestBitrate(state: boolean);\n\n    protected sendErrorEvent (code: PlayerErrorCode, extMessage?: string, data?: object) {\n        let event = document.createEvent(\"CustomEvent\");\n        let error = {\n            code: code,\n            message: PlayerErrorMessage[code],\n            extMessage: extMessage,\n            data: data\n        }\n        event.initCustomEvent(PlayerEvents.PLAYER_ERROR, false, false, error);\n        this.videoElement.dispatchEvent(event);\n    }    \n\n    protected storeDefaultLanguage (type: MediaType, lang: string) {\n        if (!this.storeMediaSettings) {\n            return;\n        }\n        let settings = this.getMediaSettings();\n        if (!settings[type]) {\n            settings[type] = {};\n        }\n        settings[type]['lang'] = lang;\n        localStorage.setItem(this.mediaSettingsKey, JSON.stringify(settings));\n    }\n\n    protected storeTextState (enable: boolean) {\n        if (!this.storeMediaSettings) {\n            return;\n        }\n        let settings = this.getMediaSettings();\n        if (!settings[MediaType.Text]) {\n            settings[MediaType.Text] = {};\n        }\n        settings[MediaType.Text]['enable'] = enable;\n        localStorage.setItem(this.mediaSettingsKey, JSON.stringify(settings));\n    }\n\n    // #endregion PROTECTED FUNCTIONS\n    // --------------------------------------------------\n\n    // #region PRIVATE FUNCTIONS\n    // --------------------------------------------------\n\n    private applyMediaSettings () {\n        let storedSettings = localStorage.getItem(this.mediaSettingsKey);\n        if (!storedSettings) {\n            return;\n        }\n        try {\n            let settings = JSON.parse(storedSettings);\n            if (settings['audio'] !== undefined && settings['audio']['lang'] !== undefined) {\n                this.setDefaultAudioLanguage(settings['audio']['lang']);\n            }\n            if (settings['text'] !== undefined && settings['text']['lang'] !== undefined) {\n                this.setDefaultTextLanguage(settings['text']['lang']);\n            }\n            if (settings['text'] !== undefined && settings['text']['enable'] !== undefined) {\n                this.setDefaultTextEnabled(settings['text']['enable']);\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    private removeMediaSettings () {\n        localStorage.removeItem(this.mediaSettingsKey);\n    }\n\n    private getMediaSettings () {\n        let settings = {};\n        let storedSettings = localStorage.getItem(this.mediaSettingsKey);\n        if (storedSettings) {\n            try {\n                settings = JSON.parse(storedSettings);\n            } catch (e) {\n                return settings;\n            }\n        }\n        return settings;\n    }\n\n    // #endregion PRIVATE FUNCTIONS\n}\n","(function(r){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=r()}else if(typeof define===\"function\"&&define.amd){define([],r)}else{var e;if(typeof window!==\"undefined\"){e=window}else if(typeof global!==\"undefined\"){e=global}else if(typeof self!==\"undefined\"){e=self}else{e=this}e.base64js=r()}})(function(){var r,e,n;return function(){function r(e,n,t){function o(f,i){if(!n[f]){if(!e[f]){var u=\"function\"==typeof require&&require;if(!i&&u)return u(f,!0);if(a)return a(f,!0);var v=new Error(\"Cannot find module '\"+f+\"'\");throw v.code=\"MODULE_NOT_FOUND\",v}var d=n[f]={exports:{}};e[f][0].call(d.exports,function(r){var n=e[f][1][r];return o(n||r)},d,d.exports,r,e,n,t)}return n[f].exports}for(var a=\"function\"==typeof require&&require,f=0;f<t.length;f++)o(t[f]);return o}return r}()({\"/\":[function(r,e,n){\"use strict\";n.byteLength=d;n.toByteArray=h;n.fromByteArray=p;var t=[];var o=[];var a=typeof Uint8Array!==\"undefined\"?Uint8Array:Array;var f=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";for(var i=0,u=f.length;i<u;++i){t[i]=f[i];o[f.charCodeAt(i)]=i}o[\"-\".charCodeAt(0)]=62;o[\"_\".charCodeAt(0)]=63;function v(r){var e=r.length;if(e%4>0){throw new Error(\"Invalid string. Length must be a multiple of 4\")}var n=r.indexOf(\"=\");if(n===-1)n=e;var t=n===e?0:4-n%4;return[n,t]}function d(r){var e=v(r);var n=e[0];var t=e[1];return(n+t)*3/4-t}function c(r,e,n){return(e+n)*3/4-n}function h(r){var e;var n=v(r);var t=n[0];var f=n[1];var i=new a(c(r,t,f));var u=0;var d=f>0?t-4:t;for(var h=0;h<d;h+=4){e=o[r.charCodeAt(h)]<<18|o[r.charCodeAt(h+1)]<<12|o[r.charCodeAt(h+2)]<<6|o[r.charCodeAt(h+3)];i[u++]=e>>16&255;i[u++]=e>>8&255;i[u++]=e&255}if(f===2){e=o[r.charCodeAt(h)]<<2|o[r.charCodeAt(h+1)]>>4;i[u++]=e&255}if(f===1){e=o[r.charCodeAt(h)]<<10|o[r.charCodeAt(h+1)]<<4|o[r.charCodeAt(h+2)]>>2;i[u++]=e>>8&255;i[u++]=e&255}return i}function s(r){return t[r>>18&63]+t[r>>12&63]+t[r>>6&63]+t[r&63]}function l(r,e,n){var t;var o=[];for(var a=e;a<n;a+=3){t=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(r[a+2]&255);o.push(s(t))}return o.join(\"\")}function p(r){var e;var n=r.length;var o=n%3;var a=[];var f=16383;for(var i=0,u=n-o;i<u;i+=f){a.push(l(r,i,i+f>u?u:i+f))}if(o===1){e=r[n-1];a.push(t[e>>2]+t[e<<4&63]+\"==\")}else if(o===2){e=(r[n-2]<<8)+r[n-1];a.push(t[e>>10]+t[e>>4&63]+t[e<<2&63]+\"=\")}return a.join(\"\")}},{}]},{},[])(\"/\")});\n","import { PlayerEvents, ProtectionData, KeySystemConfiguration, ChallengeFormatType } from '../Types'\n\nconst base64 = require('base64-js/base64js.min.js');\n\n/**\n * Dash.js player\n */\nexport class FairPlayController {\n    // #region MEMBERS\n    // --------------------------------------------------\n\n    // <video> / HTMLMediaElement\n    protected videoElement: HTMLMediaElement;\n\n    // FairPlay key system configuration\n    private keySystemConfiguration: KeySystemConfiguration;\n\n    // MediaKeySession (as WebKitMediaKeySession on Safari)\n    private mediaKeySession: any;\n\n    // The license request\n    private licenseRequest: XMLHttpRequest;\n\n    // Logs state\n    private logsEnabled: boolean;\n\n    // Events listeners\n    private needKeyListener;\n    private keyMessageListener;\n    private keyAddedListener;\n    private keyErrorListener;\n\n    // #endregion MEMBERS\n    // --------------------------------------------------\n\n    // #region CONSTRUCTOR\n    // --------------------------------------------------\n\n    /**\n     * Constructor.\n     */\n    constructor () {\n    }\n    // #endregion CONSTRUCTOR\n\n    // #region PUBLIC FUNCTIONS\n    // --------------------------------------------------\n\n    // #region SETUP\n    // --------------------------------------------------\n\n    public init (videoElement: HTMLMediaElement, protectionData: ProtectionData) {\n        this.videoElement = videoElement;\n        if (protectionData && protectionData['com.apple.fps.1_0']) {\n            this.keySystemConfiguration = protectionData['com.apple.fps.1_0'];\n        }\n        this.logsEnabled = true;\n        this.mediaKeySession = null;\n        this.licenseRequest = null;\n\n        this.needKeyListener = this.onNeedKey.bind(this);\n        this.keyMessageListener = this.onKeyMessage.bind(this);\n        this.keyAddedListener = this.onKeyAdded.bind(this);\n        this.keyErrorListener = this.onKeyError.bind(this);\n\n        this.videoElement.addEventListener('webkitneedkey', this.needKeyListener);\n    }\n\n    public reset () {\n        if (this.licenseRequest !==  null) {\n            this.licenseRequest.abort();\n            this.licenseRequest = null;\n        }\n        this.mediaKeySession = null;\n        this.videoElement.removeEventListener('webkitneedkey', this.needKeyListener);\n    }\n\n    public enableLogs (enable: boolean) {\n        this.logsEnabled = enable;\n    }\n\n    // #endregion SETUP\n    // --------------------------------------------------\n\n    // #region PRIVATE FUNCTIONS\n    // --------------------------------------------------\n\n    private debug (message: string) {\n        if (!this.logsEnabled) {\n            return;\n        }\n        console.log('[HLS-FP] ' + message);\n    }\n\n    private sendErrorEvent (e) {\n        let event = document.createEvent(\"CustomEvent\");\n        event.initCustomEvent(PlayerEvents.PLAYER_ERROR, false, false, e);\n        this.videoElement.dispatchEvent(event);\n    }\n\n    private stringToArray (str: string) {\n        let buffer = new ArrayBuffer(str.length * 2); // 2 bytes per character\n        let array = new Uint16Array(buffer);\n        for (let i = 0; i < str.length; i++) {\n            array[i] = str.charCodeAt(i);\n        }\n        return array;\n    }\n\n    private getChallengeFormatType () {\n        return (this.keySystemConfiguration && this.keySystemConfiguration.challengeFormat) ?  this.keySystemConfiguration.challengeFormat : ChallengeFormatType.OCTET_STREAM;\n    }\n\n    private extractContentId  (initData: Uint8Array) {\n        let contentId = String.fromCharCode.apply(null, new Uint16Array(initData.buffer));\n        let parts = contentId.split(\"//\");\n        if (parts.length != 2) {\n          throw \"Invalid content key format\";\n        }\n        return parts[1];\n    }\n\n    private getCertificate () {\n        if (!this.keySystemConfiguration || !this.keySystemConfiguration.serverCertificate) {\n            return new Uint8Array(0);\n        }\n        return base64.toByteArray(this.keySystemConfiguration.serverCertificate);\n    }\n\n    private concatInitDataIdAndCertificate (initData: Uint8Array, id: string, cert: Uint8Array) {\n        let idArray = (typeof id == \"string\") ? this.stringToArray(id) : id;\n\n        // layout is [initData][4 byte: idLength][idLength byte: id][4 byte:certLength][certLength byte: cert]\n        let offset = 0;\n        let buffer = new ArrayBuffer(initData.byteLength + 4 + idArray.byteLength + 4 + cert.byteLength);\n        let dataView = new DataView(buffer);\n\n        let initDataArray = new Uint8Array(buffer, offset, initData.byteLength);\n        initDataArray.set(initData);\n        offset += initDataArray.byteLength;\n\n        dataView.setUint32(offset, idArray.byteLength, true);\n        offset += 4;\n\n        let id16Array = new Uint16Array(buffer, offset, id.length);\n        id16Array.set(idArray);\n        offset += id16Array.byteLength;\n\n        dataView.setUint32(offset, cert.byteLength, true);\n        offset += 4;\n\n        let certArray = new Uint8Array(buffer, offset, cert.byteLength);\n        certArray.set(cert);\n\n        return new Uint8Array(buffer, 0, buffer.byteLength);\n    }\n\n    private processLicenseMessage (message: Uint8Array) {\n        if (this.getChallengeFormatType() === ChallengeFormatType.OCTET_STREAM) {\n            return message;\n        }\n\n        let textMessage = 'spc=' + base64.fromByteArray(message) + '&assetId=' + encodeURIComponent(this.mediaKeySession.contentId);\n        return textMessage;\n    }\n\n    private sendLicenseRequest (url: string, challenge: any) : Promise<XMLHttpRequest> {\n        return new Promise<XMLHttpRequest>((resolve, reject) => {\n            let challengeFormatType = this.getChallengeFormatType();\n            let licenseRequest = new XMLHttpRequest();\n            let success = false;\n            licenseRequest.responseType = challengeFormatType === ChallengeFormatType.OCTET_STREAM ? 'arraybuffer' : 'text';\n\n            licenseRequest.onload = function (this: XMLHttpRequest, e: ProgressEvent) {\n                if (this.status < 200 || this.status > 299) {\n                    return;\n                }    \n                if (this.status === 200 && this.readyState === 4) {\n                    success = true;\n                    resolve(this);\n                }\n            };\n\n            licenseRequest.onloadend = function (this: XMLHttpRequest, e: ProgressEvent) {\n                if (success) {\n                    return;\n                }\n                reject(this);\n            };\n\n            // licenseRequest.onerror = function (this: XMLHttpRequest, e: ErrorEvent) {\n            //     if (success) {\n            //         return;\n            //     }\n            //     reject(this);\n            // };            \n\n            licenseRequest.open('POST', url, true);\n            licenseRequest.setRequestHeader('Content-Type', challengeFormatType === ChallengeFormatType.OCTET_STREAM ? 'application/octet-stream' : 'application/x-www-form-urlencoded');\n            licenseRequest.send(challenge);            \n        });\n    }\n\n    private processLicenseResponse (request) {\n        let challengeFormatType = this.getChallengeFormatType();\n        let key;\n\n        if (challengeFormatType === ChallengeFormatType.TEXT) {\n            // Response can be of the form: '\\n<ckc>base64encoded</ckc>\\n', so trim the excess:\n            key = request.responseText.trim();\n            if (key.substr(0, 5) === '<ckc>' && key.substr(-6) === '</ckc>') {\n                key = key.slice(5,-6);\n            }\n            key = base64.toByteArray(key);\n        } else {\n            key = new Uint8Array(request.response);\n        }\n\n        this.debug('update key session');\n        this.mediaKeySession.update(key);\n    }\n\n    private getKeyError (event) {\n        var error = event.target.error,\n            code = 'MEDIA_KEYERR',\n            message = \"MediakeyError\";\n\n        if (error) {\n            switch (error.code) {\n                case 1:\n                    code = 'MEDIA_KEYERR_UNKNOWN';\n                    message = \"An unspecified error occurred. This value is used for errors that don't match any of the other codes.\";\n                    break;\n                case 2:\n                    code = 'MEDIA_KEYERR_CLIENT';\n                    message = \"The Key System could not be installed or updated.\";\n                    break;\n                case 3:\n                    code = 'MEDIA_KEYERR_SERVICE';\n                    message = \"The message passed into update indicated an error from the license service.\";\n                    break;\n                case 4:\n                    code = 'MEDIA_KEYERR_OUTPUT';\n                    message = \"There is no available output device with the required characteristics for the content protection system.\";\n                    break;\n                case 5:\n                    code = 'MEDIA_KEYERR_HARDWARECHANGE';\n                    message += \"A hardware configuration change caused a content protection error.\";\n                    break;\n                case 6:\n                    code = 'MEDIA_KEYERR_DOMAIN';\n                    message = \"An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.\";\n                    break;\n                default:\n                    code = 'MEDIA_KEYERR_UNKNOWN';\n                    message = \"An unspecified error occurred. This value is used for errors that don't match any of the other codes.\";\n                    break;\n            }\n        } else {\n            code = 'MEDIA_KEYERR_UNKNOWN';\n            message = \"An unspecified error occurred. This value is used for errors that don't match any of the other codes.\";\n        }\n        if (error.systemCode) {\n            message += \"  (System Code = \" + event.systemCode + \")\";\n        }\n        return {\n            code: code,\n            message: message\n        }\n    }\n\n    private onNeedKey (e) {\n        this.debug(\"needkey event\");\n\n        let contentId = this.extractContentId(e.initData);\n        let certificate = this.getCertificate();\n        let initData = this.concatInitDataIdAndCertificate(e.initData, contentId, certificate);\n\n        this.debug(\"create key session\");\n        let mediaKeys = new window['WebKitMediaKeys']('com.apple.fps.1_0');\n        this.videoElement['webkitSetMediaKeys'](mediaKeys);\n        this.mediaKeySession = this.videoElement['webkitKeys'].createSession('video/mp4', initData);\n\n        if (!this.mediaKeySession) {\n            throw \"Could not create key session\";\n        }\n\n        if (this.mediaKeySession.error) {\n            this.sendErrorEvent({\n                code: 'MEDIA_KEYMESSERR_NO_SESSION',\n                message: 'Failed to create key session',\n                data: this.mediaKeySession.error\n            });\n        }\n\n        this.mediaKeySession.contentId = contentId;\n\n        this.mediaKeySession.addEventListener(\"webkitkeymessage\", this.keyMessageListener);\n        this.mediaKeySession.addEventListener(\"webkitkeyadded\", this.keyAddedListener);\n        this.mediaKeySession.addEventListener(\"webkitkeyerror\", this.keyErrorListener);\n    }\n\n    private onKeyMessage (e) {\n\n        this.debug('keymessage event');\n\n        let serverUrl = this.keySystemConfiguration ? this.keySystemConfiguration.serverURL : null;\n        if (!serverUrl) {\n            this.sendErrorEvent({\n                code:'MEDIA_KEYMESSERR_URL_LICENSER_UNKNOWN',\n                message: 'No license server URL specified'\n            })\n            return;\n        }\n\n        let message = e.message;\n        message = this.processLicenseMessage(message);\n        this.debug(\"send license request\");\n        this.sendLicenseRequest(serverUrl, message)\n        .then((request) => {\n            this.debug(\"received license reponse\");\n            this.processLicenseResponse(request);\n        })\n        .catch((request) => {\n            this.sendErrorEvent({\n                code: 'MEDIA_KEYMESSERR_LICENSER_ERROR',\n                message: 'License request failed',\n                data: {\n                    status: request.status,\n                    error: request.response\n                }\n            });\n        })\n    }\n\n    private onKeyAdded (e) {\n        this.debug('keyadded event');\n    }\n\n    private onKeyError (e) {\n        this.debug('keyerror event');\n        let error = this.getKeyError(e);\n        this.sendErrorEvent(error);\n    }\n\n    // #endregion PRIVATE FUNCTIONS\n\n}\n","import { IPlayer } from '../IPlayer'\nimport { DefaultPlayer } from '../DefaultPlayer'\nimport { PlayerType, StreamInfo, MediaType, TrackInfo, ProtectionData, AudioKind, TextKind } from '../Types'\nimport { FairPlayController} from './FairPlayController'\nimport { PlayerErrorCode } from '../Errors';\n\n/**\n * Dash.js player\n */\nexport class HlsFpPlayer extends DefaultPlayer implements IPlayer {\n    // #region MEMBERS\n    // --------------------------------------------------\n\n    // Protection data\n    private protectionData: ProtectionData;\n\n    // FairPlayController\n    private fpcontroller: FairPlayController;\n\n    // Default audio language\n    private defaultAudioLanguage: string;\n\n    // Default text language\n    private defaultTextLanguage: string;\n\n    // Default text state\n    private defaultTextEnabled: boolean;\n\n    // Selected text track id before being disabled\n    private selectedTextTrackId: string;\n\n    // Events listeners\n    private loadedmetadataListener;\n    private canplayListener;\n    private seekedListener;\n    private errorListener;\n\n    // #endregion MEMBERS\n    // --------------------------------------------------\n\n    // #region CONSTRUCTOR\n    // --------------------------------------------------\n\n    /**\n     * Constructor.\n     */\n    constructor () {\n        super();\n    }\n    // #endregion CONSTRUCTOR\n\n    // #region PUBLIC FUNCTIONS\n    // --------------------------------------------------\n\n    // #region SETUP\n    // --------------------------------------------------\n\n    public getVersion (): string {\n        return '';\n    }\n\n    public getPlayerType (): PlayerType {\n        return PlayerType.DASHJS;\n    }\n        \n    public init (videoElement: HTMLElement, ttmlRenderingDiv?: HTMLDivElement) : Promise<any> {\n        super.init(videoElement, ttmlRenderingDiv);\n        this.defaultAudioLanguage = null;\n        this.defaultTextLanguage = null;\n        this.defaultTextEnabled = false;\n        this.selectedTextTrackId = null;\n\n        this.loadedmetadataListener = this.onLoadedmetadata.bind(this);\n        this.canplayListener = this.onCanPlay.bind(this);\n        this.seekedListener = this.onSeeked.bind(this);\n        this.errorListener = this.onError.bind(this);\n\n        this.videoElement.addEventListener('loadedmetadata', this.loadedmetadataListener);\n        this.videoElement.addEventListener('canplay', this.canplayListener);\n        this.videoElement.addEventListener('error', this.errorListener);\n\n        return Promise.resolve();\n    }\n\n    public setConfig (params: object) {\n    }\n \n    public enableLogs (enable: boolean) {\n        super.enableLogs(enable);\n        if (this.fpcontroller) {\n            this.fpcontroller.enableLogs(enable);\n        }\n    }\n\n    public addEventListener (type: string, listener: any, scope?: object) {\n        this.videoElement.addEventListener(type, listener, scope);\n    }\n\n    public removeEventListener (type: string, listener: any, scope?: object) {\n        this.videoElement.removeEventListener(type, listener, scope);\n    }\n\n    public reset() {\n        this.videoElement.removeEventListener('loadedmetadata', this.loadedmetadataListener);\n        this.videoElement.removeEventListener('canplay', this.canplayListener);\n        this.videoElement.removeEventListener('error', this.errorListener);\n    }\n\n    // #endregion SETUP\n    // --------------------------------------------------\n\n    // #region PLAYBACK CONTROL\n    // --------------------------------------------------\n\n    public play () {\n        this.videoElement.play();\n    }\n\n    public pause () {\n        this.videoElement.pause();\n    }\n\n    public seek (time: number) {\n        this.videoElement.currentTime = time;\n    }\n\n    public stop (reset = true, stopPlugins?: boolean) {\n        // if (this.stream === null) {\n        //     return;\n        // }\n\n        super.stop(stopPlugins);\n\n        if (reset || this.isLive()) {\n            this.videoElement.pause();\n            if (this.fpcontroller !== null) {\n                this.fpcontroller.reset();\n                this.fpcontroller = null;\n            }\n    \n            this.videoElement.removeAttribute('src');\n            this.videoElement.load();\n        } else {\n            this.videoElement.addEventListener('seeked', this.seekedListener);\n            this.videoElement.currentTime = 0;\n        }\n\n\n    }\n\n    // #endregion PLAYBACK CONTROL\n    // --------------------------------------------------\n    \n    // #region DURATION / TIME\n    // --------------------------------------------------\n\n    public getDuration () : number {\n        return this.videoElement.duration;\n    }\n\n    public isLive () {\n        return this.getDuration() !== Number.POSITIVE_INFINITY ? false : true;\n    }\n\n    public getTime () : number {\n        return this.videoElement.currentTime;  \n    }\n\n    // #endregion DURATION / TIME\n    // --------------------------------------------------\n\n    // #region AUDIO/SUBTITLES TRACKS\n    // --------------------------------------------------\n\n    public getTracksForType (type: MediaType): TrackInfo[] {\n        switch (type) {\n            case MediaType.Video:\n                return this.getVideoTracks();\n            case MediaType.Audio:\n                return this.getAudioTracks();\n            case MediaType.Text:\n                return this.getTextTracks();\n            default:\n                return null;\n        }\n    } \n\n    public getSelectedTrackForType (type: MediaType): TrackInfo {\n        switch (type) {\n            case MediaType.Audio:\n                return this.getSelectedAudioTrack();\n            case MediaType.Text:\n                return this.getSelectedTextTrack();\n            default:\n                return null;\n        }\n    }\n\n    public getQualityForType (type: MediaType): number {\n        // not available with HLS\n        return -1; \n    }\n\n    public getBufferLevelForType (type: MediaType): number {\n        // not available with HLS\n        return -1;\n    }\n\n    public selectTrackForType (type: MediaType, id: string) {\n        let lang = null;\n        switch (type) {\n            case MediaType.Audio:\n                lang = this.selectAudioTrack(id);\n                break;\n            case MediaType.Text:\n                lang = this.selectTextTrack(id);\n                this.selectedTextTrackId = id;\n                break;\n            default:\n                break;\n        }\n        if (lang) {\n            this.storeDefaultLanguage(type, lang);\n            if (type === MediaType.Text) {\n                this.storeTextState(true);\n            }\n        }\n    } \n\n    public selectTrack (track: TrackInfo) {\n        this.selectTrackForType(track.mediaType, track.id);\n    }\n\n    public setDefaultAudioLanguage (lang: string) {\n        this.defaultAudioLanguage = lang;\n    }\n\n    public setDefaultTextLanguage (lang: string) {\n        this.defaultTextLanguage = lang;\n    }\n\n    public enableText (enable: boolean) {\n        if (enable) {\n            this.selectTextTrack(this.selectedTextTrackId);\n        } else {\n            let textTracks = this.videoElement.textTracks;\n            for (var i = 0; i < textTracks.length; i++) {\n                textTracks[i].mode === 'disabled';\n            }\n        }\n        this.storeTextState(enable);\n    }\n\n    public isTextEnabled () : boolean {\n        let textTracks = this.videoElement.textTracks;\n        for (var i = 0; i < textTracks.length; i++) {\n            if (textTracks[i].mode === 'showing') {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    public setDefaultTextEnabled (enable: boolean) {\n        this.defaultTextEnabled = true;\n    }\n\n    // #endregion AUDIO/SUBTITLES TRACKS\n    // --------------------------------------------------    \n\n    // #endregion PUBLIC FUNCTIONS\n    // --------------------------------------------------\n\n    // #region PROTECTED FUNCTIONS\n    // --------------------------------------------------\n\n    protected loadStream (stream: StreamInfo) {\n        super.loadStream(stream);\n        this.selectedTextTrackId = null;\n\n        if (stream.protData) {\n            this.protectionData = stream.protData;\n        }\n\n        this.fpcontroller = new FairPlayController();\n        this.fpcontroller.init(this.videoElement, this.protectionData);\n        this.videoElement.src = stream.url;\n    }\n\n    protected limitToLowestBitrate(state: boolean) {\n        // Using built-in video player there is no mean to control bitrate\n        return;\n    }\n\n    // #endregion PROTECTED FUNCTIONS\n\n    // #region PRIVATE FUNCTIONS\n    // --------------------------------------------------\n\n    private getVideoTracks (): TrackInfo[] {\n        let tracksInfo: TrackInfo[] = [];\n        let trackInfo: TrackInfo = {\n            mediaType: MediaType.Video,\n            id: 'video',\n            selected: true,\n            codec: '',\n            mimeType: '',\n            lang: '',\n            qualities: []\n        };\n        tracksInfo.push(trackInfo);\n        return tracksInfo;\n    }\n\n    private getAudioTracks (): TrackInfo[] {\n        let tracksInfo: TrackInfo[] = [],\n            audioTracks = this.videoElement.audioTracks;\n\n        if (audioTracks.length === 0) {\n            return [];\n        }\n    \n        for (var i = 0; i < audioTracks.length; i++) {\n            tracksInfo.push(this.audioTrackToMediaInfo(audioTracks[i]));\n        }\n        return tracksInfo;\n    }\n\n    private getTextTracks (): TrackInfo[] {\n        let tracksInfo: TrackInfo[] = [],\n            textTracks = this.videoElement.textTracks;\n\n        if (textTracks.length === 0) {\n            return [];\n        }\n    \n        for (var i = 0; i < textTracks.length; i++) {\n            tracksInfo.push(this.textTrackToMediaInfo(textTracks[i]));\n        }\n        return tracksInfo;\n    }\n\n    private selectAudioTrack(id?: string, lang?: string) {\n        let audioTracks = this.videoElement.audioTracks;\n        let selectedLang = null;\n        for (var i = 0; i < audioTracks.length; i++) {\n            if ((id && audioTracks[i].id === id) || (lang && audioTracks[i].language === lang)) {\n                audioTracks[i].enabled = true;\n                selectedLang = audioTracks[i].language;\n            }\n        }\n        return selectedLang;\n    }\n\n    private selectTextTrack(id?: string, lang?: string) {\n        let textTracks = this.videoElement.textTracks;\n        let selectedLang = null;\n        for (var i = 0; i < textTracks.length; i++) {\n            if ((id && textTracks[i].label === id) || (lang && textTracks[i].language === lang)) {\n                textTracks[i].mode = 'showing';\n                selectedLang = textTracks[i].language;\n            } else {\n                textTracks[i].mode = 'disabled';\n            }\n        }\n        if (!selectedLang && textTracks.length > 0) {\n            textTracks[0].mode = 'showing';\n            selectedLang = textTracks[0].language;\n        }\n        return selectedLang;\n    }\n\n    private getSelectedAudioTrack() {\n        let audioTracks = this.videoElement.audioTracks;\n        for (var i = 0; i < audioTracks.length; i++) {\n            if (audioTracks[i].enabled) {\n                return this.audioTrackToMediaInfo(audioTracks[i]);\n            }\n        }\n        return null;\n    }\n\n    private getSelectedTextTrack() {\n        let textTracks = this.videoElement.textTracks;\n        for (var i = 0; i < textTracks.length; i++) {\n            if (textTracks[i].mode === 'showing') {\n                return this.textTrackToMediaInfo(textTracks[i]);\n            }\n        }\n        return null;\n    }\n\n    private audioTrackToMediaInfo(audioTrack: AudioTrack) {\n        let trackInfo: TrackInfo = {\n            mediaType: MediaType.Audio,\n            id: audioTrack.id,\n            selected: audioTrack.enabled,\n            kind: audioTrack.kind as AudioKind,\n            codec: '',\n            mimeType: '',\n            lang: audioTrack.language,\n            qualities: []\n        };\n        return trackInfo;\n    }\n\n    private textTrackToMediaInfo(textTrack: TextTrack) {\n        let trackInfo: TrackInfo = {\n            mediaType: MediaType.Text,\n            id: textTrack.label,\n            selected: textTrack.mode === 'showing',\n            kind: textTrack.kind as TextKind,\n            codec: '',\n            mimeType: '',\n            lang: textTrack.language,\n            qualities: []\n        };\n\n        return trackInfo;\n    }    \n\n    private onLoadedmetadata (e) {\n        if (this.defaultAudioLanguage) {\n            this.selectAudioTrack(undefined, this.defaultAudioLanguage);\n        }\n        if (this.defaultTextLanguage && this.defaultTextEnabled) {\n            this.selectTextTrack(undefined, this.defaultTextLanguage)\n        }\n    }\n\n    private onCanPlay (e) {\n        // autoplay\n        this.videoElement.play();\n    }\n\n    private onSeeked (e) {\n        // used by stop method\n        console.log('seeked');\n        this.videoElement.pause();\n        this.videoElement.removeEventListener('seeked', this.seekedListener);\n    }\n\n    private onError (e) {\n        switch (e.target.error.code) {\n            // MEDIA_ERR_ABORTED\n            case 1:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_ERR_ABORTED);\n                break;\n            // MEDIA_ERR_NETWORK\n            case 2:\n                this.sendErrorEvent(PlayerErrorCode.DOWNLOAD_ERR_CONTENT);\n                break;\n            // MEDIA_ERR_DECODE\n            case 3:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_ERR_DECODE);\n                break;\n            // MEDIA_ERR_SRC_NOT_SUPPORTED\n            case 4:\n                this.sendErrorEvent(PlayerErrorCode.DOWNLOAD_ERR_MANIFEST, '', {\n                    url: e.target.src,\n                });\n                break;\n            // MEDIA_ERR_ENCRYPTED\n            case 5:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_ERR_ENCRYPTED);\n                break;\n        }\n    }\n\n    // #endregion PRIVATE FUNCTIONS\n\n}\n","import * as dashjs from 'dashjs';\n\nexport class TTMLController {\n    // #region CONSTRUCTOR\n    // --------------------------------------------------\n\n    /**\n     * Constructor.\n     */\n    constructor () {\n    }\n    // #endregion CONSTRUCTOR\n\n    /**\n     * Initialize.\n     * @param mediaPlayer the dash.js player\n     */\n    init (mediaPlayer) {\n        mediaPlayer.on(dashjs.MediaPlayer.events.TTML_TO_PARSE, this.onTTMLPreProcess, this);\n    }\n\n    // #region PRIVATE METHODS\n    // --------------------------------------------------\n    private onTTMLPreProcess (ttmlSubtitles) {\n        if (!ttmlSubtitles || !ttmlSubtitles.data) {\n            return;\n        }\n\n        ttmlSubtitles.data = ttmlSubtitles.data.replace(/http:\\/\\/www.w3.org\\/2006\\/10\\/ttaf1/gi, 'http://www.w3.org/ns/ttml');\n        ttmlSubtitles.data = ttmlSubtitles.data.replace(/[\\w]+:region/gi, 'region');\n        ttmlSubtitles.data = ttmlSubtitles.data.replace(/[\\w]+:begin/gi, 'begin');\n        ttmlSubtitles.data = ttmlSubtitles.data.replace(/[\\w]+:end/gi, 'end');\n        ttmlSubtitles.data = ttmlSubtitles.data.replace(/[\\w]+:style/gi, 'style');\n    }\n    // #endregion PRIVATE METHODS\n}","module.exports = \"#oneplayer-debug {\\r\\n    position: absolute;\\r\\n    top: 10px;\\r\\n    left: 10px;\\r\\n    border-radius: 4px;\\r\\n    padding: 0.5em;\\r\\n    color: #fff;\\r\\n    background: rgba(28, 28, 28, 0.8);\\r\\n    font-size: 12px;\\r\\n    font-family: monospace;\\r\\n}\\r\\n\\r\\n#oneplayer-debug-metrics {\\r\\n    display: flex;\\r\\n    flex-direction: row;\\r\\n}\\r\\n\\r\\n#oneplayer-debug-metrics > div {\\r\\n    display: flex;\\r\\n    flex-direction: column;\\r\\n    justify-content: space-evenly;\\r\\n    align-content: center;\\r\\n    padding: 0px;    \\r\\n}\\r\\n\\r\\n#oneplayer-debug-metrics > .left {\\r\\n    align-items: flex-end;\\r\\n}\\r\\n\\r\\n#oneplayer-debug-metrics > .right {\\r\\n    align-items: flex-start;\\r\\n}\\r\\n\\r\\n#oneplayer-debug-metrics > div > * {\\r\\n    height: 1.5em;\\r\\n    margin: 2px 0 2px 0;\\r\\n}\\r\\n\\r\\n#oneplayer-debug-metrics > div > span {\\r\\n    padding: 0 5px;\\r\\n}\\r\\n\\r\\n#oneplayer-debug-version {\\r\\n    font-style: italic;\\r\\n    font-size: 11px;\\r\\n    padding-top: 10px\\r\\n}\\r\\n\\r\\n/* chartist style customization */\\r\\n.ct-chart {\\r\\n    background: rgba(0, 0, 0, 0.5);\\r\\n}\\r\\n\\r\\n.ct-series-a .ct-line {\\r\\n    stroke: white;\\r\\n    stroke-width: 1px;\\r\\n}\\r\\n\\r\\n.ct-series-a .ct-area {\\r\\n    fill: white;\\r\\n    fill-opacity: 0.5;\\r\\n}\\r\\n\\r\\n.ct-series-a .ct-grid {\\r\\n    stroke: rgba(255, 255, 255, 0.5);\\r\\n    stroke-width: 1px;\\r\\n    stroke-dasharray: 2px;\\r\\n}\\r\\n\\r\\n.ct-series-a .ct-point {\\r\\n    stroke: white;\\r\\n    stroke-width: 1px;\\r\\n    stroke-linecap: round;\\r\\n}\\r\\n\\r\\n/* * {\\r\\n    border: 1px solid;\\r\\n    border-color: #FFFFFF;\\r\\n} */\\r\\n\\r\\n  \";","module.exports = \"<div id='oneplayer-debug-metrics'>\\r\\n  <div class='left'>\\r\\n    <span>Protocol:</span>\\r\\n    <span>Type:</span>\\r\\n    <span>Playback state:</span>\\r\\n    <span>Playback time:</span>\\r\\n    <span id=\\\"oneplayer-debug-duration-jitter-label\\\">Duration:</span>\\r\\n    <span>Playback quality:</span>\\r\\n    <span>Video buffer:</span>\\r\\n    <span>Audio buffer:</span>\\r\\n    <span>Video bitrate:</span>\\r\\n    <span>Connection speed:</span>\\r\\n  </div>\\r\\n  <div class='right'>\\r\\n    <span id=\\\"oneplayer-debug-protocol\\\"></span>\\r\\n    <span id=\\\"oneplayer-debug-stream-type\\\"></span>\\r\\n    <span id=\\\"oneplayer-debug-playback-state\\\"></span>\\r\\n    <span id=\\\"oneplayer-debug-playback-time\\\"></span>\\r\\n    <span id=\\\"oneplayer-debug-duration-jitter\\\"></span>\\r\\n    <span id=\\\"oneplayer-debug-playback-quality\\\"></span>\\r\\n    <div class=\\\"ct-chart\\\" id=\\\"oneplayer-debug-video-buffer-chart\\\"></div>\\r\\n    <div class=\\\"ct-chart\\\" id=\\\"oneplayer-debug-audio-buffer-chart\\\"></div>\\r\\n    <div class=\\\"ct-chart\\\" id=\\\"oneplayer-debug-video-bitrate-chart\\\"></div>\\r\\n    <div class=\\\"ct-chart\\\" id=\\\"oneplayer-debug-connection-speed-chart\\\"></div>\\r\\n  </div>\\r\\n  <div class='right'>\\r\\n    <span></span>\\r\\n    <span></span>\\r\\n    <span></span>\\r\\n    <span></span>\\r\\n    <span></span>\\r\\n    <span></span>\\r\\n    <span id=\\\"oneplayer-debug-video-buffer\\\"></span>\\r\\n    <span id=\\\"oneplayer-debug-audio-buffer\\\"></span>\\r\\n    <span id=\\\"oneplayer-debug-video-bitrate\\\"></span>\\r\\n    <span id=\\\"oneplayer-debug-connection-speed\\\"></span>\\r\\n  </div>\\r\\n</div>\\r\\n<div id=\\\"oneplayer-debug-version\\\"><span></span></div>\\r\\n\";","import { OnePlayer } from '../OnePlayer'\nimport { IPlayer } from '../IPlayer'\nimport { StreamInfo, ServiceType, MediaType, Quality, PlayerType } from '../Types'\nimport { DashJSPlayer } from '../dashjs/DashJSPlayer'\n\nlet html = require('./DebugComponent.html');\nlet css = require('./DebugComponent.css');\n\nconst POLL_INTERVAL = 500; // 500ms\nconst METRICS_COUNT = 120; // 2 per seconds, 60sec\n\ndeclare global {\n    interface Window { Chartist: any; }\n}\n\nwindow.Chartist = window.Chartist || {};\n\nexport class DebugPanel {\n\n    // #region MEMBERS\n    // --------------------------------------------------\n\n    private videoElement: HTMLMediaElement;\n    private player: IPlayer;\n\n    private containerDiv: HTMLElement;\n    private debugDiv: HTMLDivElement;\n\n    // Listeners\n    private stateChangedListener;\n    private pauseListener;\n    private qualityRenderedListener;\n   \n    // Data\n    private version = '';\n    private protocol: string = '';\n    private streamType: string = '';\n    private playbackState: string = '';\n    private playbackTime: number = 0;\n    private duration: number = 0;\n    private jitter: number = 0;\n    private videoBufferSizes: number[];\n    private audioBufferSizes: number[];\n    private videoBuffer: number = 0;\n    private audioBuffer: number = 0;\n    private bufferTarget: number = 0;\n    private videoQualities: number[];\n    private videoBitrate: number = 0;\n    private connectionSpeeds: number[];\n    private connectionSpeed: number = 0;\n    private playbackQuality: number = -1;\n\n    // Charts\n    private videoBufferChart: Chartist.IChartistLineChart;\n    private audioBufferChart: Chartist.IChartistLineChart;\n    private videoBitrateChart: Chartist.IChartistLineChart;\n    private connectionSpeedChart: Chartist.IChartistLineChart;\n\n    // Interval for polling metrics\n    private pollInterval;\n\n    // Live metrics used to determine jitter\n    private liveStartTime: number;\n    private liveStartPlaybackTime: number;\n\n    // #endregion MEMBERS\n\n    // #region CONSTRUCTOR\n    // --------------------------------------------------\n\n    /**\n     * Constructor.\n     */\n    constructor (player: IPlayer, video: HTMLElement) {\n        this.player = player;\n        this.videoElement = video as HTMLMediaElement;\n        this.containerDiv = null;\n        this.debugDiv = null;\n        this.pollInterval = null;\n\n        this.videoBufferSizes = [];\n        this.audioBufferSizes = [];\n        this.videoQualities = [];\n        this.connectionSpeeds = [];\n\n        this.stateChangedListener = this.onStateChanged.bind(this);\n        this.pauseListener = this.onPause.bind(this);\n        this.qualityRenderedListener = this.onQualityRendered.bind(this);\n\n        this.registerEvents();\n\n        this.init();\n    }\n\n    // #endregion CONSTRUCTOR    \n    // --------------------------------------------------\n\n    // #region PUBLIC METHODS\n    // --------------------------------------------------\n\n    public reset() {\n        this.unregisterEvents();\n        this.show(false);\n    }\n\n    public start (stream: StreamInfo) {\n        this.init();\n        this.protocol = stream.protocol || '';\n        this.streamType = stream.type ? (stream.type === ServiceType.LIVE ? 'live' : 'static') : '';\n        this.render();\n    }\n\n    public stop() {\n        this.stopMetricsPolling();\n        this.init();\n        this.render();\n    }\n\n    public show (show: boolean, debugRenderingDiv?: HTMLDivElement) {\n        if (!show && this.debugDiv !== null) {\n            this.containerDiv.removeChild(this.debugDiv);\n            this.debugDiv = null;\n        } else if (show && this.debugDiv === null) {\n            // Create debug panel and append it to provided container or to <video> parent element\n            this.containerDiv = debugRenderingDiv ? debugRenderingDiv : this.videoElement.parentElement;\n            this.createDebugPanel();\n            this.render();\n        }\n    }\n\n    // #endregion PUBLIC METHODS\n    // --------------------------------------------------\n\n    // #region PRIVATE METHODS\n    // --------------------------------------------------\n\n    private registerEvents () {\n        this.videoElement.addEventListener('loadedmetadata', this.stateChangedListener);\n        this.videoElement.addEventListener('seeking', this.stateChangedListener);\n        this.videoElement.addEventListener('seeked', this.stateChangedListener);\n        this.videoElement.addEventListener('playing', this.stateChangedListener);\n        this.videoElement.addEventListener('waiting', this.stateChangedListener);\n        this.videoElement.addEventListener('pause', this.pauseListener);\n\n        if (this.player.getPlayerType() === PlayerType.DASHJS) {\n            this.player.addEventListener('qualityChangeRendered', this.qualityRenderedListener);\n        }\n    }\n\n    private unregisterEvents () {\n        this.videoElement.removeEventListener('loadedmetadata', this.stateChangedListener);\n        this.videoElement.removeEventListener('seeking', this.stateChangedListener);\n        this.videoElement.removeEventListener('seeked', this.stateChangedListener);\n        this.videoElement.removeEventListener('playing', this.stateChangedListener);\n        this.videoElement.removeEventListener('waiting', this.stateChangedListener);\n        this.videoElement.removeEventListener('pause', this.pauseListener);\n\n        if (this.player.getPlayerType() === PlayerType.DASHJS) {\n            this.player.removeEventListener('qualityChangeRendered', this.qualityRenderedListener);\n        }\n    }\n\n    private init() {\n        this.version = 'oneplayer.js v' + OnePlayer.getVersion() + ((this.player.getVersion().length > 0) ? (' / ' + this.player.getVersion()) : '');\n        this.protocol = '';\n        this.streamType = '';\n        this.playbackState = '';\n        this.playbackTime = 0;\n        this.duration = 0;\n        this.jitter = 0;\n        this.videoBufferSizes = [0];\n        this.audioBufferSizes = [0];\n        this.videoBuffer = 0;\n        this.audioBuffer = 0;\n        this.bufferTarget = 0;\n        this.videoQualities = [0];\n        this.videoBitrate = 0;\n        this.connectionSpeeds = [0];\n        this.connectionSpeed = 0;\n        this.playbackQuality = -1;\n\n        this.liveStartTime = 0;\n        this.liveStartPlaybackTime = 0;\n    }\n\n    private onStateChanged (e) {\n        this.playbackState = e.type;\n\n        if (e.type === 'loadedmetadata' || e.type === 'playing') {\n            this.startMetricsPolling();\n        }\n\n        if (e.type === 'playing' && this.player.isLive()) {\n            this.liveStartTime = new Date().getTime();\n            this.liveStartPlaybackTime = this.videoElement.currentTime;\n        }\n    }\n\n    private onPause (e) {\n        this.playbackState = 'paused';\n        this.render();\n        this.stopMetricsPolling();\n    }\n\n    private onQualityRendered (e) {\n        if (e.mediaType !== MediaType.Video) {\n            return;\n        }\n        this.playbackQuality = e.newQuality;\n    }\n\n    private startMetricsPolling () {\n        if (this.pollInterval !== null) {\n            return;\n        }\n        this.updateMetrics();\n        this.pollInterval = setInterval(() => {\n            this.updateMetrics();\n        }, POLL_INTERVAL);\n    }\n\n    private stopMetricsPolling () {\n        if (this.pollInterval === null) {\n            return;\n        }\n        clearInterval(this.pollInterval);\n        this.pollInterval = null;\n    }\n\n    private updateMetrics () {\n        let time = new Date().getTime();\n\n        this.streamType = this.player.isLive() ? 'live' : 'static';\n        this.playbackTime = this.videoElement.currentTime;\n        this.duration = this.videoElement.duration;\n\n        if (this.liveStartTime > 0) {\n            this.jitter = ((time - this.liveStartTime) / 1000) - (this.playbackTime - this.liveStartPlaybackTime);\n        }\n\n        if (this.player.getPlayerType() === PlayerType.DASHJS) {\n            this.updateDashMetrics();\n        }\n\n        this.render();\n    }\n\n    private updateDashMetrics () {\n        // Get dash.js metrics for audio and video\n        let mediaPlayer: DashJSPlayer = this.player as DashJSPlayer;\n\n        // Get video metrics\n        let videoMetrics = mediaPlayer.getMetricsFor(MediaType.Video);\n\n        // Update buffer target (for video and audio based on video buffer target)\n        if (videoMetrics && videoMetrics.BufferState.length > 0) {\n            this.bufferTarget = Math.max(this.bufferTarget, videoMetrics.BufferState[videoMetrics.BufferState.length - 1].target);\n        }\n        // Update video buffer level\n        this.videoBuffer = this.updateBufferLevel(videoMetrics, this.videoBufferSizes, this.videoBufferChart);\n        // Update connection speed based on video segments download speed\n        this.updateConnectionSpeed(videoMetrics);\n        \n        // Update audio buffer level\n        let audioMetrics = mediaPlayer.getMetricsFor(MediaType.Audio);\n        this.audioBuffer = this.updateBufferLevel(audioMetrics, this.audioBufferSizes, this.audioBufferChart);\n\n        this.updateVideoBitrate();\n    }\n\n    private updateBufferLevel(metrics, bufferSizes: number[], chart: Chartist.IChartistLineChart) {\n        let level = 0;\n        if (metrics && metrics.BufferLevel.length > 0) {\n            level = metrics.BufferLevel[metrics.BufferLevel.length - 1].level / 1000;\n            this.appendChartValue(bufferSizes, level);\n        }\n        if (this.debugDiv !== null) {\n            chart.options.high = this.bufferTarget;\n        }\n        return level;\n    }\n\n    private updateVideoBitrate() {\n        let videoTrack = this.player.getSelectedTrackForType(MediaType.Video);\n        if (videoTrack === null) {\n            return;\n        }\n\n        if (this.debugDiv !== null) {\n            // Update number of qualities/bitrates\n            this.videoBitrateChart.options.high = videoTrack.qualities.length - 1;\n        }\n\n        // Update current quality index\n        let qualityIndex = this.player.getQualityForType(MediaType.Video);\n        this.appendChartValue(this.videoQualities, qualityIndex);\n\n        // Get corresponding bitrate\n        let quality: Quality = videoTrack.qualities[qualityIndex];\n        this.videoBitrate = quality.bitrate;\n    }\n\n    private updateConnectionSpeed(metrics) {\n\n        if (!metrics || metrics.HttpList.length === 0) {\n            return;\n        }\n\n        let request = metrics.HttpList[metrics.HttpList.length - 1];\n        if (request.responsecode !== 200) {\n            return;\n        }\n        let responseTime = new Date(request.tresponse);\n        let finishTime = new Date(request._tfinish)\n        let downloadTimeInSeconds = (finishTime.getTime() - responseTime.getTime()) / 1000;\n        let downloadBytes = request.trace.reduce((a, b) => a + b.b[0], 0);\n        this.connectionSpeed = Math.round((8 * downloadBytes) / downloadTimeInSeconds);\n\n        this.appendChartValue(this.connectionSpeeds, this.connectionSpeed);\n        if (this.debugDiv !== null) {\n            this.connectionSpeedChart.options.high = Math.max(this.connectionSpeedChart.options.high, this.connectionSpeed);\n        }\n    }\n\n    private appendChartValue(values: number[], value) {\n        if (values.length >= METRICS_COUNT) {\n            values.shift();\n        }\n        values.push(value);\n    }\n\n    private render () {\n        if (!this.debugDiv) {\n            return;\n        }\n\n        this.debugDiv.querySelector(\"#oneplayer-debug-version\").innerHTML = this.version;\n\n        if (this.streamType !== '') {\n            this.debugDiv.querySelector(\"#oneplayer-debug-duration-jitter-label\").innerHTML = this.streamType === 'live' ? 'Jitter:' : 'Duration:';\n        }\n\n        this.debugDiv.querySelector(\"#oneplayer-debug-protocol\").innerHTML = this.protocol;\n        this.debugDiv.querySelector(\"#oneplayer-debug-stream-type\").innerHTML = this.streamType;\n        this.debugDiv.querySelector(\"#oneplayer-debug-playback-state\").innerHTML = this.playbackState;\n        this.debugDiv.querySelector(\"#oneplayer-debug-playback-time\").innerHTML = this.playbackTime.toFixed(3) + 's';\n        this.debugDiv.querySelector(\"#oneplayer-debug-duration-jitter\").innerHTML = this.streamType === 'live' ? (this.jitter.toFixed(3) + 's'): this.formatDuration(this.duration);\n        this.debugDiv.querySelector(\"#oneplayer-debug-playback-quality\").innerHTML = this.getPlaybackQualityInfos();\n        this.debugDiv.querySelector(\"#oneplayer-debug-video-buffer\").innerHTML = this.videoBuffer.toFixed(1) + 's';\n        this.debugDiv.querySelector(\"#oneplayer-debug-audio-buffer\").innerHTML = this.audioBuffer.toFixed(1) + 's';\n        this.debugDiv.querySelector(\"#oneplayer-debug-video-bitrate\").innerHTML = this.formatBitrate(this.videoBitrate);\n        this.debugDiv.querySelector(\"#oneplayer-debug-connection-speed\").innerHTML = this.formatBitrate(this.connectionSpeed);\n\n        this.videoBufferChart.update({\n            series: [this.videoBufferSizes]\n        }, this.videoBufferChart.options);\n\n        this.audioBufferChart.update({\n            series: [this.audioBufferSizes]\n        }, this.audioBufferChart.options);\n\n        this.videoBitrateChart.update({\n            series: [this.videoQualities]\n        }, this.videoBitrateChart.options);\n\n        this.connectionSpeedChart.update({\n            series: [this.connectionSpeeds]\n        }, this.connectionSpeedChart.options);\n\n        // Set debug panel visible\n        this.debugDiv.style.visibility = 'visible';\n    }\n\n    private formatDuration (duration: number) {\n        let s =  duration.toFixed(3) + 's';\n        if (duration < 60) {\n            return s;\n        }\n        s += ' (';\n        if (duration > 3600) {\n            s += Math.floor(duration / 3600) + 'h';\n        }\n        if (duration > 60) {\n            s += Math.floor(duration % 3600 / 60) + 'm';\n        }\n        s += (duration % 60).toFixed(3) + 's)';\n        return s;\n    }\n\n    private formatBitrate (bitrate: number) {\n        let bitrateInKbps = Math.round(bitrate / 1000);\n        if (bitrateInKbps > 1000) {\n            return (bitrateInKbps / 1000).toFixed(1) + 'Mb/s';\n        }\n        return bitrateInKbps + 'Kb/s';\n    }\n\n    private getPlaybackQualityInfos () {\n        if (this.playbackQuality === -1) {\n            return '';\n        }\n\n        let videoTrack = this.player.getSelectedTrackForType(MediaType.Video);\n        if (videoTrack === null) {\n            return '';\n        }\n\n        let quality: Quality = videoTrack.qualities[this.playbackQuality];\n        let qualityInfos = this.formatBitrate(quality.bitrate);\n        if (quality.width && quality.height) {\n            qualityInfos += ' - ' + quality.width + 'x' + quality.height;\n        }\n        qualityInfos += ' (' + (this.playbackQuality + 1) + '/' + videoTrack.qualities.length + ')';\n        return qualityInfos;\n    }\n\n    private loadChartist () {\n        let node = document.createElement('script');\n        node.src = 'https://cdnjs.cloudflare.com/ajax/libs/chartist/0.11.0/chartist.js';\n        node.type = 'text/javascript';\n        node.onload = this.ShowDebug.bind(this);\n        document.getElementsByTagName('head')[0].appendChild(node);\n    }\n\n    private ShowDebug () {\n        // Add debug panel styles\n        this.addStyles('oneplayer-debug-styles', css);\n\n        // Create <div> for debug panel\n        this.debugDiv = document.createElement('div');\n        this.debugDiv.style.visibility = 'hidden';\n        this.debugDiv.id = 'oneplayer-debug';\n        this.debugDiv.innerHTML = html;\n\n        // Append it to provided container or to <video> parent element\n        this.containerDiv.appendChild(this.debugDiv);\n\n        // Create buffer size charts\n        let optionsBufferChart: Chartist.ILineChartOptions = {\n            high: this.bufferTarget,\n            low: 0,\n            fullWidth: true,\n            showPoint: false,\n            showLine: false,\n            showArea: true,\n            chartPadding: {\n                bottom: 0,\n                left: 0,\n                right: 0,\n                top: 0\n            },\n            axisX: {\n                showGrid: false,\n                showLabel: false,\n                offset: 0\n            },\n            axisY: {\n                showGrid: false,\n                showLabel: false,\n                offset: 0\n            },\n            lineSmooth: window.Chartist.Interpolation.none()\n        };\n\n        this.videoBufferChart = new window.Chartist.Line('#oneplayer-debug-video-buffer-chart', {\n            series: [this.videoBufferSizes]\n        }, optionsBufferChart);\n\n        this.audioBufferChart = new window.Chartist.Line('#oneplayer-debug-audio-buffer-chart', {\n            series: [this.videoBufferSizes]\n        }, optionsBufferChart);\n\n        // Create video bitrate chart\n        this.videoBitrateChart = new window.Chartist.Line('#oneplayer-debug-video-bitrate-chart', {\n            series: [this.videoQualities]\n        }, {\n            low: 0,\n            fullWidth: true,\n            showPoint: false,\n            showLine: true,\n            showArea: false,\n            chartPadding: {\n                bottom: 0,\n                left: 0,\n                right: 0,\n                top: 0\n            },\n            axisX: {\n                showGrid: false,\n                showLabel: false,\n                offset: 0\n            },\n            axisY: {\n                showGrid: false,\n                showLabel: false,\n                offset: 0\n            },\n            lineSmooth: window.Chartist.Interpolation.step()\n        });\n\n        // Create connection speed chart\n        this.connectionSpeedChart = new window.Chartist.Line('#oneplayer-debug-connection-speed-chart', {\n            series: [this.connectionSpeeds]\n        }, {\n            low: 0,\n            fullWidth: true,\n            showPoint: false,\n            showLine: true,\n            showArea: false,\n            chartPadding: {\n                bottom: 0,\n                left: 0,\n                right: 0,\n                top: 0\n            },\n            axisX: {\n                showGrid: false,\n                showLabel: false,\n                offset: 0\n            },\n            axisY: {\n                showGrid: false,\n                showLabel: false,\n                offset: 0\n            },\n            lineSmooth: window.Chartist.Interpolation.simple()\n        });\n    }\n\n    private createDebugPanel () {\n        if(!window.Chartist.Interpolation) {\n            this.loadChartist();\n        } else {\n            this.ShowDebug();\n        }\n    }\n\n    private addStyles(id: string, css: any) {\n        let head = this.getHeadSection();\n\n        // Check if not already existing\n        let style = head.querySelector('#' + id);\n        if (style) {\n            return;\n        }\n\n        style = document.createElement('style');\n        style.id = id;\n        style.innerHTML = css;\n        head.appendChild(style);        \n    }\n\n    private getHeadSection() {\n        // Get <head> section\n        let elements = document.getElementsByTagName('head');\n        if (elements.length > 0) {\n            return elements[0];\n        }\n\n        // Create <head> if not existing\n        let head = document.createElement('head');\n        document.body.appendChild(head);\n        return head;\n    }\n\n    // #endregion PRIVATE METHODS\n    // --------------------------------------------------\n\n}\n\n","import { OnePlayer } from '../OnePlayer'\nimport { IPlayer } from '../IPlayer'\nimport { StreamInfo } from '../Types'\nimport { DebugPanel } from './DebugPanel'\n\n\nexport class DebugController {\n\n    // #region MEMBERS\n    // --------------------------------------------------\n\n    private player: IPlayer;\n\n    private debugPanel: DebugPanel;\n\n    private debug: boolean;\n    private verbose: boolean;\n\n    private onKeyPressedListener;\n\n    // #endregion MEMBERS\n\n    // #region CONSTRUCTOR\n    // --------------------------------------------------\n\n    /**\n     * Constructor.\n     */\n    constructor (player: IPlayer, video: HTMLElement) {\n        this.player = player;\n        this.debug = false;\n        this.verbose = false;\n        this.onKeyPressedListener = this.onKeyPressed.bind(this);\n        window.addEventListener('keydown', this.onKeyPressedListener);\n        this.debugPanel = new DebugPanel(player, video);\n    }\n\n    public reset() {\n        this.debugPanel.reset();\n    }\n\n    public start(stream: StreamInfo) {\n        this.debugPanel.start(stream);\n    }\n\n    public stop() {\n        this.debugPanel.stop();\n    }\n    \n    public showDebugPanel (show: boolean, debugRenderingDiv?: HTMLDivElement) {\n        this.debugPanel.show(show, debugRenderingDiv);\n    }\n\n    // #endregion CONSTRUCTOR    \n    // --------------------------------------------------\n\n    // #region PRIVATE METHODS\n    // --------------------------------------------------\n\n    private onKeyPressed (e: KeyboardEvent) {\n\n        // Handle ctrl+alt+maj+d to show/hide debug panel\n        if ((e.altKey === true) && (e.ctrlKey === true) && (e.shiftKey === true) && (e.keyCode === 68)) {\n            this.debug = !this.debug;\n            this.debugPanel.show(this.debug);\n        }\n\n        // Handle ctrl+alt+maj+v to enable/disable logs\n        if ((e.altKey === true) && (e.ctrlKey === true) && (e.shiftKey === true) && (e.keyCode === 86)) {\n            this.verbose = !this.verbose;\n            console.log('oneplayer.js debug ' + (this.verbose ? 'ON': 'OFF'));\n            let playerVersion = this.player.getVersion();\n            console.log('oneplayer.js v' + OnePlayer.getVersion() + (playerVersion.length > 0) ? (' / ' + playerVersion) : '');\n            this.player.enableLogs(this.verbose);\n        }\n    }\n\n    // #endregion PRIVATE METHODS\n    // --------------------------------------------------\n}","\n\nexport class PlaybackSpeedController {\n\n    // #region MEMBERS\n    // --------------------------------------------------\n\n    // <video> / HTMLMediaElement\n    private videoElement: HTMLMediaElement;    \n\n    // Playback speed\n    private speed: number = 0;\n\n    // Trick mode speed\n    private trickModeSpeed: number = 0;\n\n    // Original volume level\n    private volume: number;\n\n    // The time at which seek has been done\n    private seekTime: number;\n\n    // The timeout for seeking\n    private seekTimeout;\n\n    private onSeekedListener;\n\n    private playPromise: Promise<any>;\n\n    // #endregion MEMBERS\n    // --------------------------------------------------\n\n    // #region CONSTRUCTOR\n    // --------------------------------------------------\n\n    /**\n     * Constructor.\n     */\n    constructor () {\n    }\n\n    // #endregion CONSTRUCTOR\n\n    // #region PUBLIC METHODS\n    // --------------------------------------------------\n\n    public init (videoElement: HTMLMediaElement) {\n        this.videoElement = videoElement;\n        this.volume = null;\n        this.playPromise = null;\n        this.onSeekedListener = this.onSeeked.bind(this);\n    }\n\n    public reset () {\n        this.stopTrickMode();\n\n        // Restore volume level\n        if (this.volume) {\n            this.videoElement.volume = this.volume;\n            this.volume = null;\n        }\n    }\n\n    public setSpeed (speed: number) {\n        // console.log('[TRICK_PLAY] setSpeed: ' + speed);\n\n        // Ignore value 0, method pause() has to be used instead\n        // Ignore negative values between -1 and 0 (not supported)\n        if (speed <= 0 &&  speed > -1) {\n            throw new Error('The provided playback speed (' + speed + ') is not in the supported range');\n        }\n\n        // Check if duration is available (stream initialized)\n        if (isNaN(this.videoElement.duration)) {\n            throw new Error('Playback speed can not be changed until video is not initialized');\n        }\n\n        this.speed = speed;\n\n        // Apply new speed now if not already in trick mode and if playback is not being (re)started\n        // => if already in trick mode, then apply new speed once current seek is done (see onSeeked)\n        // => if playback is being (re)started, then apply new speed once play is done (see onPlay)\n        if (this.trickModeSpeed === 0 && this.speed !== 1 && this.playPromise === null) {\n            this.applySpeed();\n        }\n    }\n\n    public getSpeed () : number {\n        return this.trickModeSpeed === 0 ? this.videoElement.playbackRate : this.trickModeSpeed;\n    }\n\n    // #endregion PUBLIC METHODS\n\n    // #region PRIVATE METHODS\n    // --------------------------------------------------\n\n    private applySpeed () {\n        // From normal playback to slow motion or fast forward/rewind, then set mute on\n        if (this.videoElement.playbackRate === 1 && this.trickModeSpeed === 0 && this.speed !== 1) {\n            this.volume = this.videoElement.volume;\n            // console.log('[TRICK_PLAY] mute on (' + this.volume + ')');\n            this.videoElement.volume = 0;\n        }\n\n        // If normal playback or slow motion then stop trick mode\n        if (Math.abs(this.speed) <= 1 && this.trickModeSpeed !== 0) {\n            // console.log('[TRICK_PLAY] stop trick mode');\n            this.stopTrickMode();\n        }\n\n        // For negative values and values > 1 then start/run trick mode at given speed\n        if (this.speed <= -1 || this.speed > 1) {\n            if (this.trickModeSpeed === 0) {\n                // Switch to lowest quality\n                // this.limitToLowestBitrate(true);\n\n                // Start trick mode\n                // console.log('[TRICK_PLAY] start trick mode');\n                this.startTrickMode(this.speed);\n            } else if (this.trickModeSpeed !== this.speed) {\n                // Or modify trick mode speed\n                // console.log('[TRICK_PLAY] update speed: ' + this.speed);\n                this.trickModeSpeed = this.speed;\n            }\n        }\n\n        // For speed between 0 and 1 (slow motion or normal playback) then simply modify the playbackRate of the HTML video element\n        if (this.speed > 0 && this.speed <= 1) {\n            this.videoElement.playbackRate = this.speed;\n            // For normal playback, play if in paused mode\n            if (this.videoElement.paused) {\n                // console.log('[TRICK_PLAY] play');\n                this.playPromise = this.videoElement.play().then(this.onPlay.bind(this));\n            }\n        }        \n    }\n \n    private startTrickMode (speed: number) {\n        // console.log('[TRICK_PLAY] start trick mode');\n\n        this.trickModeSpeed = speed;\n\n        // Pause video and set playbackRate to 1\n        this.videoElement.pause();\n        this.videoElement.playbackRate = 1;\n\n        // Add 'seeked' listener\n        this.videoElement.addEventListener('seeked', this.onSeekedListener);\n\n        // Start seeking\n        this.seek();\n    }\n\n    private stopTrickMode () {\n        // console.log('[TRICK_PLAY] stop trick mode');\n\n        // Remove 'seeked' listener\n        this.videoElement.removeEventListener('seeked', this.onSeekedListener);\n\n        // Cancel seek timeout\n        clearTimeout(this.seekTimeout);\n\n        this.trickModeSpeed = 0;\n    }\n\n    private seek () {\n        this.seekTime = new Date().getTime();\n        let seekPos = this.videoElement.currentTime + this.trickModeSpeed;\n        // console.log('[TRICK_PLAY] seek: ' + seekPos);\n        this.videoElement.currentTime = Math.min(Math.max(seekPos, 0), this.videoElement.duration);\n    }\n\n    private onSeeked () {\n        // console.log('[TRICK_PLAY] seeked');\n\n        // On Safari we need to pause again since seeking restarts playback automatically\n        this.videoElement.pause();\n\n        let time = new Date().getTime();\n        let elapsedTime = time - this.seekTime;\n        // console.log('[' + time + '] seeked - elapsed time = ' + elapsedTime + ', wait for ' + Math.max((1000 - elapsedTime), 0) + ' ms');\n\n        this.applySpeed();\n\n        // Still in trick mode => seek again\n        if (this.trickModeSpeed !== 0 &&\n            this.videoElement.currentTime > 0 &&\n            this.videoElement.currentTime < this.videoElement.duration) {\n            this.seekTimeout = setTimeout(() => {\n                this.seek();\n            }, Math.max((1000 - elapsedTime), 0));\n        }\n    }\n\n    private onPlay() {\n        // console.log('[TRICK_PLAY] playing');\n\n        this.playPromise = null;\n\n        this.applySpeed();\n\n        // If normal playback, restore volume level\n        if (this.videoElement.playbackRate === 1 && this.volume) {\n            // console.log('[TRICK_PLAY] mute off => ' + this.volume);\n            this.videoElement.volume = this.volume;\n            this.volume = null;\n        }\n    }\n\n    // #endregion PRIVATE METHODS\n}","module.exports = __WEBPACK_EXTERNAL_MODULE__14__;","import { IPlugin } from './IPlugin'\nimport { PluginType, StreamInfo, PlayerEvents } from '../Types'\nimport { IPlayer } from '../IPlayer'\nimport { DefaultPlayer } from '../DefaultPlayer'\nimport { AdsPlayer, EventTypes, ErrorCodes } from 'adsplayer.js';\n\n/**\n * adsplayer.js plugin\n */\nexport class AdsPlugin implements IPlugin {\n    // #region MEMBERS\n    // --------------------------------------------------\n\n    // <video> / HTMLMediaElement\n    protected videoElement: HTMLMediaElement; \n\n    // IPlayer instance\n    protected player: DefaultPlayer;\n\n    // AdsPlayer instance\n    private adsPlayer: AdsPlayer;\n\n    // The HTML5 div to render ads\n    private adsRenderingDiv;\n\n    // Parameter to indicate adsplayer.js to handle or not main video playback\n    private handleMainPlayerPlayback;\n\n    // #endregion MEMBERS\n    // --------------------------------------------------\n\n    // #region CONSTRUCTOR\n    // --------------------------------------------------\n\n    /**\n     * Constructor.\n     */\n    constructor () {\n    }\n    // #endregion CONSTRUCTOR\n\n    // #region PUBLIC FUNCTIONS\n    // --------------------------------------------------\n\n    // #region SETUP\n    // --------------------------------------------------\n\n    public getType (): string {\n        return PluginType.METRICS\n    }\n\n    public getVersion (): string {\n        this.checkInitialized();\n        return 'adsplayer.js_' + this.adsPlayer.getVersion();\n    }\n    \n    public init (player: IPlayer, videoElement: HTMLMediaElement, config: object) {\n\n        if (!config['adsRenderingDiv']) {\n            throw new Error('Failed to initialize Ad-insertion plugin: div for rendering ads must be provided');\n        }\n\n        this.handleMainPlayerPlayback = true;\n        if (config['handleMainPlayerPlayback']) {\n            this.handleMainPlayerPlayback = config['handleMainPlayerPlayback'];\n        }\n\n        this.videoElement = videoElement;\n        this.player = player as DefaultPlayer;\n        this.adsRenderingDiv = config['adsRenderingDiv'];\n        this.adsPlayer = new AdsPlayer();\n        this.adsPlayer.init(this.videoElement, this.adsRenderingDiv, this.handleMainPlayerPlayback);\n        this.adsPlayer.addEventListener(EventTypes.ERROR, this.onError.bind(this));\n        this.adsPlayer.addEventListener(EventTypes.START, this.onStart.bind(this));\n        this.adsPlayer.addEventListener(EventTypes.END, this.onEnd.bind(this));\n        this.adsPlayer.addEventListener(EventTypes.ADD_ELEMENT, this.onAddElement.bind(this));\n        this.adsPlayer.addEventListener(EventTypes.REMOVE_ELEMENT, this.onRemoveElement.bind(this));\n        this.adsPlayer.addEventListener(EventTypes.PLAY, this.onPlay.bind(this));\n        this.adsPlayer.addEventListener(EventTypes.PAUSE, this.onPause.bind(this));\n        this.adsPlayer.addEventListener(EventTypes.CLICK, this.onClick.bind(this));\n    }\n\n    public enableLogs (enable: boolean) {\n        this.adsPlayer.enableLogs(enable);\n    }\n\n    public reset() {\n        this.checkInitialized();\n        this.adsPlayer.destroy();\n    }\n\n    // #endregion SETUP\n    // --------------------------------------------------\n\n    // #region PLUGIN CONTROL\n    // --------------------------------------------------\n\n    public load (stream: StreamInfo): Promise<any> {\n        this.checkInitialized();\n        return new Promise<any>((resolve, reject) => {\n            this.adsPlayer.load(stream)\n            .then((res) => {\n                resolve(res ? 'preroll' : '');\n            })\n            .catch((e) => {\n                resolve();\n            })    \n        });\n    }\n\n    public stop () {\n        this.checkInitialized();\n        this.adsPlayer.reset();\n        this.videoElement.style.display = 'block';\n        this.adsRenderingDiv.style.display = 'none';\n    }\n\n    // #endregion PLUGIN CONTROL\n    // --------------------------------------------------\n    \n    \n    // #region PRIVATE FUNCTIONS\n    // --------------------------------------------------\n\n    private checkInitialized() {\n        if (!this.adsPlayer) {\n            throw 'Ad-Insertion plugin not initialized';\n        } \n    }\n\n    private onError (e) {\n        let error = {\n            code: e.data.code,\n            message:  e.data.message,\n            extMessage: '',\n            data: e.data.data\n        }\n        this.sendEvent(PlayerEvents.AD_ERROR, error);\n    }\n\n    private onStart (e) {\n        this.sendEvent(PlayerEvents.AD_START, e.data);\n        this.videoElement.style.display = 'none';\n        this.adsRenderingDiv.style.display = 'block';\n    }\n\n    private onEnd (e) {\n        this.videoElement.style.display = 'block';\n        this.adsRenderingDiv.style.display = 'none';\n        this.sendEvent(PlayerEvents.AD_END);\n    }\n\n    private onAddElement(e) {\n        console.log(\"adsplayer - \" + e.type + \" / \" + e.data.type);\n    }\n    \n    private onRemoveElement(e) {\n        console.log(\"adsplayer - \" + e.type + \" / \" + e.data.type);\n    }\n\n    private onPlay(e) {\n        console.log(\"adsplayer - \" + e.type);\n    }\n    \n    private onPause(e) {\n        console.log(\"adsplayer - \" + e.type);\n    }\n\n    private onClick(e) {\n        console.log(\"adsplayer - \" + e.type);\n        // if (e.data.uri) {\n        //     window.open(e.data.uri);\n        // }\n    }\n\n    private sendEvent (eventType: PlayerEvents, data?: object) {\n        let event = document.createEvent(\"CustomEvent\");\n        event.initCustomEvent(eventType, false, false, data);\n        this.videoElement.dispatchEvent(event);\n    }\n\n    // #endregion PRIVATE FUNCTIONS\n\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__16__;","import { IPlugin } from './IPlugin'\nimport { PluginType, StreamInfo } from '../Types'\nimport { IPlayer } from '../IPlayer'\nimport * as MetricsAgent from 'metricsagent.js';\n\nconst DEFAULT_SETTINGS = {\n    name: 'Prisme (local)',\n    activationUrl: '',\n    serverUrl: 'http://localhost:3004/metrics',\n    enable: true,\n    dbServerUrl: '',\n    collector: 'OnePlayerCollector',\n    formatter: 'Prisme',\n    sendingTime: 10000\n};\n\n/**\n * metricsagent.js plugin\n */\n\nexport class MetricsPlugin implements IPlugin {\n    // #region MEMBERS\n    // --------------------------------------------------\n\n    // MetricsAgent instance\n    private metricsAgent;\n\n    // #endregion MEMBERS\n    // --------------------------------------------------\n\n    // #region CONSTRUCTOR\n    // --------------------------------------------------\n\n    /**\n     * Constructor.\n     */\n    constructor () {\n    }\n    // #endregion CONSTRUCTOR\n\n    // #region PUBLIC FUNCTIONS\n    // --------------------------------------------------\n\n    // #region SETUP\n    // --------------------------------------------------\n\n    public getType (): string {\n        return PluginType.METRICS\n    }\n\n    public getVersion (): string {\n        this.checkInitialized();\n        return 'metricsagent.js_' + this.metricsAgent.getVersion();\n    }\n\n    public init (player: IPlayer, videoElement: HTMLMediaElement, config: object) {\n\n        // Get default settings and update with provided settings\n        let settings = DEFAULT_SETTINGS;\n        for(var key in config) settings[key] = config[key];\n\n        this.metricsAgent = new MetricsAgent(settings);\n        this.metricsAgent.init(player, videoElement);\n    }\n\n    public enableLogs (enable: boolean) {\n    }  \n\n    public reset() {\n        this.checkInitialized();\n        this.metricsAgent.destroy();\n    }\n\n    // #endregion SETUP\n    // --------------------------------------------------\n\n    // #region PLUGIN CONTROL\n    // --------------------------------------------------\n\n    /**\n     * Load/open a video stream.\n     * @param {object} stream - video stream properties object such url, startTime, prodData ...\n     */    \n    public load (stream: StreamInfo): Promise<any> {\n        return new Promise<any>((resolve, reject) => {\n            this.metricsAgent.load(stream);\n            resolve();\n        });\n    }\n\n    /**\n     * Stops/reset the playback of the video stream.\n     */\n    public stop () {\n        this.metricsAgent.reset();\n    }\n\n    // #endregion PLUGIN CONTROL\n    // --------------------------------------------------\n    \n    \n\n    // #region PRIVATE FUNCTIONS\n    // --------------------------------------------------\n\n    private checkInitialized() {\n        if (!this.metricsAgent) {\n            throw 'Metrics plugin not initialized';\n        } \n    }\n\n    // #endregion PRIVATE FUNCTIONS\n\n}\n","import { IPlayer } from '../IPlayer'\nimport { DefaultPlayer } from '../DefaultPlayer'\nimport { PlayerType, StreamInfo, MediaType, TrackInfo, AudioKind, TextKind } from '../Types'\nimport { PlayerErrorCode } from '../Errors'\nimport { TTMLController } from './TTMLController';\nimport * as dashjs from 'dashjs';\nimport { MediaPlayerClass } from 'dashjs';\n\nconst DASHJS_PLAYER_NOT_INITIALIZED_ERROR = 'DashJS player not initialized!';\n\nconst DEFAULT_SETTINGS = {\n    'MSS': {\n        'LIVE': {\n            liveDelay: 16,\n            stableBufferTime: 16,\n            bufferTimeAtTopQuality: 16,\n            bufferTimeAtTopQualityLongForm: 16,\n            lowLatencyEnabled: false,\n            keepProtectionMediaKeys: true\n        }\n    }\n};\n\nconst MEDIAINFO_TYPE_TO_MEDIATYPE = {\n    'video': MediaType.Video,\n    'audio': MediaType.Audio,\n    'text': MediaType.Text,\n    'fragmentedText': MediaType.Text,\n    'embeddedText': MediaType.Text\n};\n\n/**\n * Dash.js player\n */\nexport class DashJSPlayer extends DefaultPlayer implements IPlayer {\n    // #region MEMBERS\n    // --------------------------------------------------\n\n    // Dash.js player\n    private mediaPlayer: MediaPlayerClass;\n\n    // Default settings\n    private defaultSettings: object = {};\n\n    // Audio settings\n    private audioSettings: object = {};\n\n    // Download error\n    private downloadError;\n\n    // TTML Controller in charge of preproccessing TTML datas before parsing\n    private ttmlController: TTMLController;\n\n    // #endregion MEMBERS\n    // --------------------------------------------------\n\n    // #region CONSTRUCTOR\n    // --------------------------------------------------\n\n    /**\n     * Constructor.\n     */\n    constructor () {\n        super();\n        this.mediaPlayer = dashjs.MediaPlayer().create();\n        this.mediaPlayer.on(dashjs.MediaPlayer.events.ERROR, this.onError, this);\n        this.mediaPlayer.on(dashjs.MediaPlayer.events.PLAYBACK_PLAYING, this.onPlaybackPlaying, this);\n        this.mediaPlayer.on(dashjs.MediaPlayer.events.PLAYBACK_SEEKING, this.onPlaybackSeeking, this);\n        this.mediaPlayer.on(dashjs.MediaPlayer.events.PLAYBACK_WAITING, this.onPlaybackWaiting, this);\n\n        this.ttmlController = new TTMLController();\n        this.ttmlController.init(this.mediaPlayer);\n\n        this.getDefaultSettings();\n    }\n    // #endregion CONSTRUCTOR\n\n    // #region PUBLIC FUNCTIONS\n    // --------------------------------------------------\n\n    // #region SETUP\n    // --------------------------------------------------\n\n    public getVersion (): string {\n        this.checkInitialized();\n        return 'dash.js_' + this.mediaPlayer.getVersion();\n    }\n\n    public getPlayerType (): PlayerType {\n        return PlayerType.DASHJS;\n    }\n\n    public init (videoElement: HTMLElement, ttmlRenderingDiv?: HTMLDivElement) : Promise<any> {\n        this.checkInitialized();\n        super.init(videoElement, ttmlRenderingDiv);\n\n        // Attach video element\n        this.mediaPlayer.initialize(this.videoElement, undefined, true);\n\n        // Initialize text (subtitles/captions) rendering\n        if (ttmlRenderingDiv) {\n            this.mediaPlayer.attachTTMLRenderingDiv(ttmlRenderingDiv);\n        } else {\n            ttmlRenderingDiv = document.createElement('div');\n            if (this.videoElement.parentNode) {\n                this.videoElement.parentNode.appendChild(ttmlRenderingDiv);\n                this.mediaPlayer.attachTTMLRenderingDiv(ttmlRenderingDiv);\n            }\n        }\n\n        // Disable media settings caching in local storage\n        this.mediaPlayer.enableLastMediaSettingsCaching(false);\n\n        // Enable last bitrate caching in local storage\n        this.mediaPlayer.enableLastBitrateCaching(true);\n\n        this.mediaPlayer.setLowLatencyEnabled(false);\n\n        return Promise.resolve();\n    }\n\n    public setConfig (params: object) {\n        this.checkInitialized();\n        // Store given settings in default settings\n        for (let key in params) {\n            this.defaultSettings[key] = params[key];\n        }\n        this.applySettings(params);\n    }\n \n    public enableLogs (enable: boolean) {\n        super.enableLogs(enable);\n        this.checkInitialized();\n        this.mediaPlayer.getDebug().setLogToBrowserConsole(enable);\n    }\n  \n    public addEventListener (type: string, listener: any, scope?: object) {\n        this.checkInitialized();\n        this.mediaPlayer.on(type, listener, scope);\n    }\n\n    public removeEventListener (type: string, listener: any, scope?: object) {\n        this.checkInitialized();\n        this.mediaPlayer.off(type, listener, scope);\n    }\n\n    public reset() {\n        super.reset();\n        this.checkInitialized();\n        this.mediaPlayer.reset();\n    }\n\n    public getMetricsFor(type: MediaType) {\n        this.checkInitialized();\n        return this.mediaPlayer.getMetricsFor(this.getType(type));        \n    }\n\n    // #endregion SETUP\n    // --------------------------------------------------\n\n    // #region PLAYBACK CONTROL\n    // --------------------------------------------------\n\n    public play () {\n        this.checkInitialized();\n        this.mediaPlayer.play();\n    }\n\n    public pause () {\n        this.checkInitialized();\n        this.mediaPlayer.pause();\n    }\n\n    public seek (time: number) {\n        this.checkInitialized();\n        this.mediaPlayer.seek(time);\n    }\n\n    public stop (reset = true, stopPlugins?: boolean) {\n        super.stop(reset, stopPlugins);\n        this.checkInitialized();\n        if (reset || this.mediaPlayer.isDynamic()) {\n            this.mediaPlayer.attachSource(null);\n        } else {\n            this.pause();\n            this.seek(0);\n        }\n    }\n\n    // #endregion PLAYBACK CONTROL\n    // --------------------------------------------------\n    \n    // #region DURATION / TIME\n    // --------------------------------------------------\n\n    public getDuration () : number {\n        this.checkInitialized();\n        if (!this.mediaPlayer.isReady()) {\n            return 0;\n        }\n        return this.mediaPlayer.duration();\n    }\n\n    public isLive () {\n        this.checkInitialized();\n        return this.mediaPlayer.isDynamic();\n    }\n\n    public getTime () : number {\n        this.checkInitialized();\n        if (!this.mediaPlayer.isReady()) {\n            return 0;\n        }\n        return this.mediaPlayer.time(undefined);  \n    }\n\n    // #endregion DURATION / TIME\n    // --------------------------------------------------\n\n    // #region AUDIO/SUBTITLES TRACKS\n    // --------------------------------------------------\n\n    public getTracksForType (type: MediaType): TrackInfo[] {\n        this.checkInitialized();\n\n        let tracksInfo: TrackInfo[] = [];\n        let mediaType = this.getType(type);\n        let selectedTrack = this.mediaPlayer.getCurrentTrackFor(mediaType);\n        let tracks = this.mediaPlayer.getTracksFor(mediaType);\n        for (let i = 0; i < tracks.length; i++) {\n            tracksInfo.push(this.mediaInfoToTrackInfo(tracks[i], tracksInfo.length, tracks[i] === selectedTrack));\n        }\n\n        return tracksInfo;\n    } \n\n    public getSelectedTrackForType (type: MediaType): TrackInfo {\n        this.checkInitialized();\n\n        let trackInfos = this.getTracksForType(type);\n        for (let i = 0; i < trackInfos.length; i++) {\n            if (trackInfos[i].selected) {\n                return trackInfos[i];\n            }\n        }\n        return null;\n    }\n\n    public getQualityForType (type: MediaType): number {\n        this.checkInitialized();\n        return this.mediaPlayer.getQualityFor(this.getType(type));\n    }\n\n    public getBufferLevelForType (type: MediaType): number {\n        this.checkInitialized();\n        return this.mediaPlayer.getBufferLength(this.getType(type));\n    }\n\n    public selectTrackForType (type: MediaType, id: string) {\n        this.checkInitialized();\n\n        let mediaType = this.getType(type);\n        let tracks = this.mediaPlayer.getTracksFor(mediaType);\n        if (!tracks || tracks.length === 0) {\n            return;\n        }\n        let track = (tracks.filter((mediaInfo, idx) => {\n            return (mediaInfo.id === undefined) ? (idx === parseInt(id)) : (mediaInfo.id === id);\n        }))[0];\n\n        this.storeDefaultLanguage(type, track.lang);\n        this.mediaPlayer.setCurrentTrack(track);\n    } \n\n    public selectTrack (track: TrackInfo) {\n        this.selectTrackForType(track.mediaType, track.id);\n    }\n\n    public setDefaultAudioLanguage (lang: string) {\n        this.checkInitialized();\n        this.audioSettings['lang'] = lang;\n    }\n\n    public setDefaultTextLanguage (lang: string) {\n        this.checkInitialized();\n        this.mediaPlayer.setTextDefaultLanguage(lang);\n    }\n\n    public enableText (enable: boolean) {\n        this.checkInitialized();\n        this.storeTextState(enable);\n        this.mediaPlayer.enableText(enable);\n    }\n\n    public isTextEnabled () : boolean {\n        this.checkInitialized();\n        return this.mediaPlayer.isTextEnabled();\n    }\n\n    public setDefaultTextEnabled (enable: boolean) {\n        this.checkInitialized();\n        this.mediaPlayer.setTextDefaultEnabled(enable);\n    }\n\n    // #endregion AUDIO/SUBTITLES TRACKS\n    // --------------------------------------------------    \n\n    // #endregion PUBLIC FUNCTIONS\n    // --------------------------------------------------\n\n    // #region PROTECTED FUNCTIONS\n    // --------------------------------------------------\n\n    protected loadStream (stream: StreamInfo) {\n        super.loadStream(stream);\n        this.checkInitialized();\n\n        if (stream.protData) {\n            this.mediaPlayer.setProtectionData(stream.protData);\n        }\n\n        this.downloadError = null;\n\n        this.mediaPlayer.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED, this.onStreamInitialized, this);\n\n        // Restore default settings\n        this.applySettings(this.defaultSettings);\n\n        // Apply settings according to protocol and service type\n        if (stream.protocol && stream.type) {\n            if (DEFAULT_SETTINGS[stream.protocol] && DEFAULT_SETTINGS[stream.protocol][stream.type]) {\n                this.applySettings(DEFAULT_SETTINGS[stream.protocol][stream.type]);\n            }    \n        }\n\n        this.mediaPlayer.attachSource(stream.url);\n\n        // Set audio initial settings after attachSource(), since attachSource() does reset previous stream media settings\n        this.mediaPlayer.setInitialMediaSettingsFor('audio', this.audioSettings);\n    }\n\n    protected limitToLowestBitrate(state: boolean) {\n        if (state === true) {\n            // Switch to lowest quality\n            let videoInfo = this.getSelectedTrackForType(MediaType.Video);\n            let audioInfo = this.getSelectedTrackForType(MediaType.Audio);\n            this.mediaPlayer.setMaxAllowedBitrateFor('video', Math.floor(videoInfo.qualities[0].bitrate / 1000) + 1);\n            this.mediaPlayer.setMaxAllowedBitrateFor('audio', Math.floor(audioInfo.qualities[0].bitrate / 1000) + 1);\n        } else {\n            // Reset max allowed bit rate\n            this.mediaPlayer.setMaxAllowedBitrateFor('video', NaN);\n            this.mediaPlayer.setMaxAllowedBitrateFor('audio', NaN);            \n        }\n    }\n\n    // #endregion PROTECTED FUNCTIONS\n\n    // #region PRIVATE FUNCTIONS\n    // --------------------------------------------------\n\n    private checkInitialized() {\n        if (!this.mediaPlayer) {\n            throw DASHJS_PLAYER_NOT_INITIALIZED_ERROR;\n        } \n    }\n\n    private getDefaultSettings () {\n        this.defaultSettings['liveDelay'] = this.mediaPlayer.getLiveDelay();\n        this.defaultSettings['stableBufferTime'] = this.mediaPlayer.getStableBufferTime();\n        this.defaultSettings['bufferTimeAtTopQuality'] = this.mediaPlayer.getBufferTimeAtTopQuality();\n        this.defaultSettings['bufferTimeAtTopQualityLongForm'] = this.mediaPlayer.getBufferTimeAtTopQualityLongForm();\n        this.defaultSettings['lowLatencyEnabled'] = this.mediaPlayer.getLowLatencyEnabled();\n    }\n\n    private applySettings (settings) {\n        if (settings.liveDelay) {\n            this.mediaPlayer.setLiveDelay(settings.liveDelay);\n        }\n        if (settings.stableBufferTime) {\n            this.mediaPlayer.setStableBufferTime(settings.stableBufferTime);\n        }\n        if (settings.bufferTimeAtTopQuality) {\n            this.mediaPlayer.setBufferTimeAtTopQuality(settings.bufferTimeAtTopQuality);\n        }\n        if (settings.bufferTimeAtTopQualityLongForm) {\n            this.mediaPlayer.setBufferTimeAtTopQualityLongForm(settings.bufferTimeAtTopQualityLongForm);\n        }\n        if (settings.lowLatencyEnabled) {\n            this.mediaPlayer.setLowLatencyEnabled(settings.lowLatencyEnabled);\n        }\n        if (settings.keepProtectionMediaKeys) {\n            this.mediaPlayer.keepProtectionMediaKeys(settings.keepProtectionMediaKeys);\n        }\n        if (settings.minVideoBitrate) {\n            this.mediaPlayer.setMinAllowedBitrateFor('video', settings.minVideoBitrate);\n        }\n    }\n\n    private mediaInfoToTrackInfo (mediaInfo: dashjs.MediaInfo, index: number, selected: boolean) {\n        let trackInfo: TrackInfo = {\n            mediaType: MEDIAINFO_TYPE_TO_MEDIATYPE[mediaInfo.type],\n            id: (mediaInfo.id !== undefined) ? mediaInfo.id : index.toString(),\n            selected: selected,\n            codec: mediaInfo.codec,\n            mimeType: mediaInfo.mimeType,\n            lang: mediaInfo.lang,\n            qualities: mediaInfo.bitrateList.map(function (item) {\n                return {\n                    bitrate: item.bandwidth,\n                    width: item.width,\n                    height: item.height\n                }\n            })\n        };\n\n        // For audio tracks, determine track kind value\n        if (trackInfo.mediaType === MediaType.Audio && mediaInfo.roles) {\n            if (mediaInfo.roles.indexOf('main') !== -1) {\n                trackInfo.kind = AudioKind.Main;\n            }\n            if (mediaInfo.roles.indexOf('dub') !== -1) {\n                trackInfo.kind = AudioKind.Translation;\n            }\n            if (mediaInfo.roles.indexOf('alternate') !== -1) {\n                trackInfo.kind = (mediaInfo.accessibility && mediaInfo.accessibility.indexOf('2') !== -1) ? AudioKind.Clean : AudioKind.Alternative;\n            }\n            if (mediaInfo.roles.indexOf('commentary') !== -1) {\n                trackInfo.kind = AudioKind.Commentary;\n            }\n        }\n\n        // For text tracks, determine track kind value\n        if (trackInfo.mediaType === MediaType.Text && mediaInfo.roles) {\n            if (mediaInfo.roles.indexOf('main') !== -1) {\n                trackInfo.kind = (mediaInfo.accessibility && mediaInfo.accessibility.indexOf('2') !== -1) ? TextKind.Descriptions : TextKind.Captions;\n            } else if (mediaInfo.roles.indexOf('alternate') !== -1) {\n                trackInfo.kind = TextKind.Subtitles;\n            }\n        }\n\n        return trackInfo;\n    }\n\n    private onStreamInitialized (e) {\n        this.mediaPlayer.off(dashjs.MediaPlayer.events.STREAM_INITIALIZED, this.onStreamInitialized, this);\n\n        // If start time is specified then seek at start time\n        if (this.stream.startTime) {\n            this.mediaPlayer.seek(this.stream.startTime);\n        }\n    }\n\n    private getResponseText (response) {\n        return response.responseType === 'text' ? response.responseText : ''\n    }\n\n    private getType (dashType) {\n        return dashType === MediaType.Text ? 'fragmentedText' : dashType\n    }\n\n    private onPlaybackPlaying (e) {\n        this.downloadError = null;\n    }\n\n    private onPlaybackSeeking (e) {\n        this.downloadError = null;\n    }\n\n    private onPlaybackWaiting (e) {\n        this.processDownloadError();\n    }\n\n    private processDownloadError () {\n        if (this.downloadError === null) {\n            return;\n        }\n\n        let mediaType = MEDIAINFO_TYPE_TO_MEDIATYPE[this.downloadError.data.request.mediaType];\n\n        // Consider only audio and video segments download error\n        if (mediaType !== MediaType.Video && mediaType !== MediaType.Audio) {\n            return;\n        }\n\n        // Check readyState to know if enough data to enable playback\n        if (this.videoElement.readyState > 2 && this.videoElement.playbackRate > 0) {\n            return;\n        }\n\n        // Trigger error \n        this.sendErrorEvent(PlayerErrorCode.DOWNLOAD_ERR_CONTENT, this.downloadError.message, {\n            type: mediaType,\n            url: this.downloadError.data.request.url,\n            status: this.downloadError.data.response.status,\n            response: this.getResponseText(this.downloadError.data.response),\n            segmentTime: this.downloadError.data.request.startTime,\n            segmentDuration: this.downloadError.data.request.duration,\n        });\n\n        // Reset download error\n        this.downloadError = null;\n    }\n\n    private onError (e) {\n        // Ignore deprecated errors\n        if (e.event) {\n            return;\n        }\n        \n        let error = e.error;\n        switch (error.code) {\n            // HTMLMediaElement\n            case 1:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_ERR_ABORTED, error.message);\n                break;\n            case 2:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_ERR_NETWORK, error.message);\n                break;\n            case 3:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_ERR_DECODE, error.message);\n                break;\n            case 4:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_ERR_SRC_NOT_SUPPORTED, error.message);\n                break;\n            case 5:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_ERR_ENCRYPTED, error.message);\n                break;\n\n            // MSE\n            case dashjs.MediaPlayer.errors.CAPABILITY_MEDIASOURCE_ERROR_CODE:\n                this.sendErrorEvent(PlayerErrorCode.CAPABILITY_ERR_MEDIASOURCE);\n                break;\n\n            case dashjs.MediaPlayer.errors.MEDIASOURCE_TYPE_UNSUPPORTED_CODE:\n                this.sendErrorEvent(PlayerErrorCode.CAPABILITY_ERR_MEDIASOURCE, error.message);\n                break;\n\n            // Download errors\n            case dashjs.MediaPlayer.errors.DOWNLOAD_ERROR_ID_MANIFEST_CODE:\n                this.sendErrorEvent(PlayerErrorCode.DOWNLOAD_ERR_MANIFEST, error.message, {\n                    url: error.data.request.url,\n                    status: error.data.response.status,\n                    response: this.getResponseText(error.data.response)\n                });\n                break;\n            case dashjs.MediaPlayer.errors.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE:\n            case dashjs.MediaPlayer.errors.DOWNLOAD_ERROR_ID_CONTENT_CODE:\n                this.downloadError = error;\n                this.processDownloadError();\n                break;\n\n            // EME\n            case dashjs.MediaPlayer.errors.CAPABILITY_MEDIAKEYS_ERROR_CODE:\n                this.sendErrorEvent(PlayerErrorCode.CAPABILITY_ERR_MEDIAKEYS, error.message);\n                break;\n\n            case dashjs.MediaPlayer.errors.MEDIA_KEYERR_UNKNOWN_CODE:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_KEYERR_UNKNOWN, error.message);\n                break;\n\n            case dashjs.MediaPlayer.errors.MEDIA_KEYERR_CLIENT_CODE:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_KEYERR_CLIENT, error.message);\n                break;\n\n            case dashjs.MediaPlayer.errors.MEDIA_KEYERR_SERVICE_CODE:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_KEYERR_SERVICE, error.message);\n                break;\n\n            case dashjs.MediaPlayer.errors.MEDIA_KEYERR_OUTPUT_CODE:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_KEYERR_OUTPUT, error.message);\n                break;\n\n            case dashjs.MediaPlayer.errors.MEDIA_KEYERR_DOMAIN_CODE:\n                this.sendErrorEvent(PlayerErrorCode.MEDIA_KEYERR_DOMAIN, error.message);\n                break;\n\n            case dashjs.MediaPlayer.errors.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE:\n                this.sendErrorEvent(PlayerErrorCode.MEDIAKEYS_ERR_KEYSYSTEM_ACCESS, error.messageS);\n                break;\n\n            case dashjs.MediaPlayer.errors.SERVER_CERTIFICATE_UPDATED_ERROR_CODE:\n                this.sendErrorEvent(PlayerErrorCode.MEDIAKEYS_ERR_SERVER_CERTIFICATE, error.message);\n                break;\n\n            case dashjs.MediaPlayer.errors.KEY_SESSION_CREATED_ERROR_CODE:\n                this.sendErrorEvent(PlayerErrorCode.MEDIAKEYS_ERR_CREATE_SESSION, error.message);\n                break;\n\n            case dashjs.MediaPlayer.errors.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE:\n                this.sendErrorEvent(PlayerErrorCode.MEDIAKEYS_ERR_UNKNOWN_LICENSER, error.message);\n                break;\n\n            case dashjs.MediaPlayer.errors.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE:\n                this.sendErrorEvent(PlayerErrorCode.MEDIAKEYS_ERR_LICENSE_REQUEST, error.message, {\n                    url: '',\n                    code: 0,\n                    response: error.message\n                });\n                break;\n\n            case dashjs.MediaPlayer.errors.MEDIA_KEYERR_CODE:\n                this.sendErrorEvent(PlayerErrorCode.MEDIAKEYS_ERR_KEY_ERROR, error.message);\n                break;\n\n            case dashjs.MediaPlayer.errors.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE:\n                this.sendErrorEvent(PlayerErrorCode.MEDIAKEYS_ERR_EXPIRED, error.message);\n                break;\n\n            default:\n                this.sendErrorEvent(PlayerErrorCode.PLAYER_INTERNAL_ERROR, error.message, error);\n                break;\n        }\n    }\n\n/*    \n    MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE:          10;\n    MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE:          12;\n    XLINK_LOADER_LOADING_FAILURE_ERROR_CODE:             13;\n    SEGMENTS_UPDATE_FAILED_ERROR_CODE:                   14;\n    SEGMENTS_UNAVAILABLE_ERROR_CODE:                     15;\n    SEGMENT_BASE_LOADER_ERROR_CODE:                      16;\n    TIME_SYNC_FAILED_ERROR_CODE:                         17;\n    FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE:          18;\n    FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE:             19;\n    URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE:            20;\n    APPEND_ERROR_CODE:                                   21;\n    REMOVE_ERROR_CODE:                                   22;\n    DATA_UPDATE_FAILED_ERROR_CODE:                       23;\n\n\n    DOWNLOAD_ERROR_ID_XLINK_CODE:                        30;\n    MANIFEST_ERROR_ID_PARSE_CODE:                        32;\n    MANIFEST_ERROR_ID_NOSTREAMS_CODE:                    33;\n    TIMED_TEXT_ERROR_ID_PARSE_CODE:                      34;\n    MANIFEST_ERROR_ID_MULTIPLEXED_CODE:                  35;\n\n\n    MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE:          108;\n    MSS_NO_TFRF_CODE:                                   200;      \n*/\n\n    // #endregion PRIVATE FUNCTIONS\n\n}\n","export { PlayerType, StreamInfo, ServiceType, HasProtocol, MediaType, TrackInfo, AudioKind, TextKind, PluginType, PlayerEvents } from './src/Types';\nexport { PlayerError, PlayerErrorCode } from './src/Errors';\nexport { IPlayer } from './src/IPlayer';\nexport { OnePlayer } from './src/OnePlayer';\n"],"sourceRoot":""}